dac($("box"),""),Res.loadUp=()=>setTimeout(()=>{let t=$("loading");t.style.background="#0000",t._h(),ac($("box")),$E.loadComp()},$("loading").style.background||!$E.edit?200:400),$E.loadComp=()=>CIW.onready(()=>{$E.pro.initLib();let t=location.search.slice(1);t?$E.open(decodeURIComponent(t),1):$E.openGame()}),Ipc.beforeClose=()=>Ipc.closeMsg=$E.modified?"0{7s}":"";{let t=[Res.loadBg({id:0,m:0})];Res.sndList.for(o=>t.push(Res.loadSnd(o))),Res.sprList.for((o,i)=>t.push(Res.loadSpr(o,Lib.thm[i]))),Res.fontList.for(o=>t.push(Res.loadFont(o)));for(let o=0;o<5;o++)t.push(Res.loadEmoji(o));Res.loadMax=t.length,Promise.all(t).catch(t=>{console.error(t),Res.fail(),dac($("box"),"")}),$c("page").for(t=>t.onmousedown=t=>{t.stopPropagation(),1===t.button&&t.preventDefault()}),$E.tab.for((t,o)=>t.onclick=()=>{$E.nowTab!==o&&(!o||$E._r?($E.nowTab=o,css($E.tab,{borderColor:""},o,{borderColor:"#5af"}),$("page").style.transform=`translateX(-${25*o}%)`):UI.$a("0{7t}"))});let o=$("btn").ch,i=$("rbtn").ch;o[0].onclick=()=>{if(!$E.GAME.R.length)return UI.$a("0{7u}");let t=$("screen");css(t,{background:"none",pointerEvents:"none"}),$t("canvas",t).for(t=>t._h()),$("htrack")._h(),$("vtrack")._h(),$("btn")._h(),$("rbtn")._s(),$("ctrl-e")._h(),$("ctrl-r")._s(),dac($("L"),""),$("bgmPv").hC("p")&&$("bgmPv").click(),$E.edit=!1,$R=new Core.$R($E.exportGame(0,1),1),$R.init(()=>i[0].click()),$E.loadComp=()=>$R?.start([$E._r?.ind,0,-1][App.gC("edit","start")],1)},o[0].reset=()=>{$E.edit=!0;let t=$("screen");css(t,{background:"",pointerEvents:""}),$t("canvas",t).for(t=>t._s()),$("htrack")._s(),$("vtrack")._s(),$("btn")._s(),$("rbtn")._h(),$("ctrl-e")._s(),$("ctrl-r")._h(),$E.inEdit||ac($("L")),css($("loading"),{background:"#0000",display:"none"}),ac($("box"))},o[1].onclick=$E.openGame,o[2].onclick=()=>{let t=$E.exportGame();t&&($E.GAME.id&&(t.id=$E.GAME.id),CIW.put("proj",t).then(t=>{$E.GAME.id=t.target.result,UI.$a("0{7v}"),$E.modified=!1},t=>{console.error(t),UI.$a("0{7w}")}))},o[3].onclick=()=>{$E._r&&UI.confirm("0{7x}").then(t=>{if(t.i)return;$E.C._U();let o=$E._r;o.obj=(o.flag?.[2]??"|").repeat(o.ly.length-1),o.dec(),$E.$O&&$E.$P()})},o[4].onclick=()=>(new UI.M).t("0{7y}").t("- Cloud I Wanna 0{7z} (.ciwp)").t("- Jtool 0{80} (.jmap)").b("0{81}","0{6}").then(t=>{t.i||UI.file(".ciwp,.jmap",t=>"ciwp"===t.slice(t.lastIndexOf(".")+1)?"DataURL":"Text").then(([t,o])=>{let i=$E.import[o.slice(o.lastIndexOf(".")+1)];i?i(t):UI.$a("0{82}")})}),o[5].onclick=()=>{let t=$E.exportGame(),o=UI.S("0{83}",1);t&&new UI.M(300).h("0{1p}").ac(o,UI.span("0{84} "),UI.S("0{85}",1,1).on(function(t){for(let o=this.nS();o;o=o.nS())o.set(t)}),...t.R.map(t=>UI.S("- "+t.name,1))).b("0{1p}","0{6}").then(function(i){if(!i.i){this.hold=!0,o.v||(t._s=[]);for(let i=t.R.length;i--;){let e=t.R[i];o.nS(3+i).v?o.v||(delete e.spr,delete e.bg,delete e.col):t.R.splice(i,1)}Ipc.zip(JSON.stringify(t),1,o=>{o?Ipc.dl(new Blob([o]),t.N+".ciwp",0,t=>t&&UI.$a("0{86}")):UI.$a("0{87}"),this.close()})}})},o[6].onclick=()=>UI.$a("0{88}"),css(o[7].ch,{color:"#888"},2,{}),o[7].onclick=function(t){let o=t.target,i=[...this.ch];if("SPAN"===o.tagName){let t=Number(o.innerText);if(!isNaN(t))return css(i.slice(2),{color:"#888"}),o.style.color="",$E.grid.set(t),$E.grid.draw()}$E.grid.show=!$E.grid.show,css(i.slice(0,2),{color:$E.grid.show?"":"#888"}),$E.grid.draw()},i[0].onclick=()=>{$R.exit(),o[0].reset()},doc.fonts.ready.then(()=>{[[["time","timer","",72],["dth","skull","",40]],[["room","warp","",72,"dots"]],[["plyX","ply"," x",66],["plyY",0,"y",66],["plyA",0,"xa",34]],[["fps",0,"FPS",28],["per",0,"",40],["rps",0,"",20],["perD",0,"",40]]].for((t,o)=>{let e=0,r=i[o+1];t.for(t=>{let o=r.ap(El("span","ib",{innerHTML:t[1]?UI.ico(t[1])+t[2]:t[2]})),i=r.ap(El("span",t[4]?"ab "+t[4]:"ab")),d=o.offsetWidth+t[3];o.style.width=d+"px",e+=d,i.id="g-"+t[0],css(i,{left:e-t[3]+12+"px",width:t[3]+"px",whiteSpace:"nowrap"})})}),css(i,{pointerEvents:"none"},0),$("rbtn")._h();let t=$("cbtn"),o=[];["keyboard","set"].for(i=>{let e=El("div","hover");e.innerHTML=UI.ico(i),o.push(e.ap(El("div","pointer"))),t.ap(e)});let e=UI.O("0{89}","0{8a}","0{8b}");e.set(App.gC("edit","start")),o[0].ap(El("div","box",{id:"ctrl-e"}),El("div","box",{id:"ctrl-r"})),o[1].ap(El("div","box")._c(UI.span("0{8c}"),UI.Bar(150,App.gC("run","vol")/100,1,0,"var(--cbtl)").in(t=>Au.setVol(100*t)).on(t=>{App.sC("run","vol",Math.round(100*t))}),UI.I("0{8d}",{m:.2,M:1,s:.1,value:App.gC("edit","gridOpacity")}).on(t=>{App.sC("edit","gridOpacity",t),$E.grid.al=t,$E.grid.draw()}),El("br"),UI.I("0{8e}",{m:10,M:500,value:App.gC("edit","undoDepth")}).on(t=>App.sC("edit","undoDepth",t)),UI.S("0{8f}",$E.showInvis).on(t=>{App.sC("edit","showInvis",t),$E.showInvis=t,$E.sfO.redraw()}),UI.S("0{8g}",App.gC("edit","autoSpk")).on(t=>App.sC("edit","autoSpk",t)),UI.span("0{8h}"),e.on(t=>App.sC("edit","start",t)))),css($c("box",t),{right:0,width:"240px",padding:"12px",fontSize:"16px"}),[[["0{8i}","0{8j}"],["0{8k}","0{8l}"],["Ctrl+0{8i}","0{8m}"],["Ctrl+0{8k}","0{8n}"],["Ctrl+0{8o}","0{8p}"],["Shift+0{8o}","0{8q}"],["W,A,S,D","0{8r}"],["0{8s}","0{8t}"],["0{8u}","0{8v}"],["0{8w}","0{8x}"],["0{8y},Delete","0{8z}"],["Alt","0{90}"],["Ctrl+S","0{1m}"],["Ctrl+A","0{85}"],["Ctrl+C","0{91}"],["Ctrl+V","0{92}"],["Ctrl+X","0{93}"],["Ctrl+Z","0{94}"],["Ctrl+Shift+Z","0{95}"],["Tab","0{96}"],["G","0{97}"]],[["Ctrl+G","0{98}"],["Ctrl+S","0{99}"],["Ctrl+0{8i}","0{9a}"],["Ctrl+0{8s}","0{9b}"]]].for((t,i)=>t.for(t=>o[0].ch[i].ap(El("div","op").tx(t[0])._c(El("span","fr").tx(t[1]))).style.paddingRight="6px")),o[0].lastChild._h()});let e=$c("cat");e[0].ap(UI.I("0{9c}",{l:32},330).on(t=>$E.GAME.N=t));let r=UI.p(UI.ico("add")+"0{9d}");r.onclick=()=>$E.addVar(),css(r,{display:"inline-block",marginLeft:"7px",cursor:"pointer"});let d=El("p").tx("0{9e}");d.ap(UI.help("0{9f}"),UI.span("0{9g}",0,15)),e[1].ap(UI.C("0{9h}",0,"0{9i}","0{9j}","0{9k}").on(t=>$E.GAME.S=t),d,El("div",0,{id:"vars"}),r),docReady.then(()=>{e[2].firstChild.ap(UI.help("0{z}")),e[2].onmousemove=function(t){if(t.stopPropagation(),this.drag){let o=this.dragI+(t.y-this.dragY+16>>5),i=this.drag.room.ind;if(o!==i&&(o<0&&(o=0),0===o&&0===$E._R[o].type&&(o=1),o>=$E._R.length&&(o=$E._R.length-1),o!==i)){let t=o-i;t<0?$E.rU(this.drag,this.drag.pS(-t)):$E.rD(this.drag,this.drag.nS(t))}}},e[2].onmouseleave=e[2].onmouseup=function(){this.drag&&(this.drag.style.borderColor=this.drag.firstChild.firstChild.style.background="",this.drag=null,this.style.cursor="",css($c("room"),{pointerEvents:""}))};let t=El("div");["0{9l}","0{9m}","0{9n}"].for(o=>t.ap(El("div","setcat").tx(o),El("div","setpage"))),t.style.height="426px",UI.bindCat(t),t.clr=()=>{t.now&&(t.now.id="",t.now=null,t.newR=null)},t.chk=(o,i)=>{$E._R.find(t=>t.type===i)?(dac(o),o===t.now&&t.clr()):ac(o)},t.set=(o,i,e)=>{let r=$("thmSrc");r&&(r.id=""),o.id="thmSrc",t.newR=i,t.now=o,t.tab=e};let o=$c("setpage",t);css(o,{bottom:"64px"}),["0{6w}","0{6x}","0{6y}","0{6z}","0{70}"].for((i,e)=>{let r=o[0].ap(El("div","thm").tx(i));r.onclick=()=>t.set(r,e,0),3===e&&r._h()}),o[0].set=function(){for(let o=2;o--;)t.chk(this.ch[o],o)},o[0].ap(UI.p("0{6w}0{9o}"),UI.p("0{6x}0{9p}"),UI.p("0{70}0{9q}")),t.pv=o=>{let i=El("div","thm"),e=i.ap(El("div","thm-pv"));css(e,{width:"200px",height:"152px",background:`url(${$M.c(o.p)})`});let r=i.ap(El("p").tx(o.n));return o.createdAt||(r.ap(UI.span(UI.ico("trash"))).onclick=e=>{e.stopPropagation(),UI.confirm("0{9r}").then(e=>{e.i||CIW.del("tpl",o.id).then(()=>{i===t.now&&t.clr(),i.remove()})})},r.ap(UI.span(UI.ico("upload"))).onclick=t=>{t.stopPropagation(),UI.confirm("0{9s}").then(t=>{if(!t.i){if(o.c.includes("_")||o.b.id?.includes?.("_"))return UI.$a("0{9t}");let t=DB.O("Template");for(let i in o)"id"!==i&&t.set(i,o[i]);t.save().then(t=>{CIW.put("tpl",{...o,id:t.id,createdAt:t.createdAt}),UI.$a("0{9u}")},t=>UI.$a("0{9v}"))}})},css(r.ch,{margin:"4px",pointerEvents:"auto",color:"var(--c)"})),i.r=(t=>{let o={flag:t.f,type:t.t,w:t.w??800,h:t.h??608,obj:t.o,bg:t.b,spr:t.c?Res.decSpr(t.c):[]};return t.k&&(o.col=t.k),t.d&&(o.bobj=JSON.stringify(t.d)),o})(o),i.onclick=()=>t.set(i,i.r,i.tab),i},o[1].set=function(){this.loaded?$c("thm",this).for(o=>{o.r.type<2&&t.chk(o,o.r.type)}):CIW.find("tpl").then(o=>{let i=new Date(0);o.for(o=>{if(!o.createdAt)return;let e=this.ap(t.pv(o));e.tab=1,e.r.type<2&&t.chk(e,e.r.type);let r=new Date(o.createdAt);r>i&&(i=r)}),this.loaded=!0,DB.Q("Template").greaterThan("createdAt",i).find().then(o=>o.for(o=>{let i=o.toJSON();i.id=i.objectId,delete i.objectId,delete i.ACL,delete i.updatedAt;let e=this.ap(t.pv(i));e.tab=1,e.r.type<2&&t.chk(e,e.r.type),CIW.put("tpl",i)}))})},o[2].ids=[],o[2].set=function(){$c("thm",this).for(o=>{o.r.type<2&&t.chk(o,o.r.type)}),CIW.find("tpl").then(o=>{o.for(o=>{if(o.createdAt)return;if(this.ids.includes(o.id))return;let i=this.ap(t.pv(o));i.tab=2,this.ids.push(o.id),i.r.type<2&&t.chk(i,i.r.type)})})},$("crtr").onclick=i=>{new UI.M(800,512).h("0{10}").cb().ap(t).b("0{5}","0{6}").then(o=>{t.now&&(t.now.id=""),o.i||void 0!==t.newR&&null!==t.newR&&(t.newR.w?$E.addRoom(new $E.Room(2,t.newR)).firstChild.click():$E.addRoom(new $E.Room(t.newR)).firstChild.click())}),t.now?(t.now.id="thmSrc",o[t.tab].set()):t.firstChild.onclick()},e[3].ap(UI.I("0{9w}",{l:8},80).on(t=>{$E._r.name=t,$c("room")[$E._r.ind].firstChild.lastChild.tx(t)}),UI.I("0{9x}",{type:"number",m:800,M:4e3,s:32},40).on(t=>$E._r.setWH(t)),UI.I("×",{m:608,M:3040,s:32},40).on(t=>$E._r.setWH(0,t)),UI.C("0{9y}",0,"0{9z}","0{56}","0{a0}","0{a1}","0{a2}").on(t=>$E._r.out=t),UI.C("0{a3}",0,"0{a4}","0{a5}").on(t=>$E._r.view=t),UI.B("0{a6}",1).on(()=>UI.prompt("0{a7}").then(t=>{if(!t.i){$E._r.enc(1);let o=(t=>{let o=$E._r.save(),i={id:Date.now().toString(36),n:t,f:o.flag,t:o.type,o:o.obj,b:o.bg,c:Res.encSpr(o.spr),p:$M.m($E.capture(.25,8))};return 800!==o.w&&(i.w=o.w),608!==o.h&&(i.h=o.h),o.col&&(i.k=o.col),o.bobj&&(i.d=JSON.parse(o.bobj)),$M.eq(i.c,Lib.thm)&&delete i.c,i})(t.v);CIW.put("tpl",o).then(t=>UI.$a("0{7v}"))}})));let i=UI.C("0{a8}",0,"0{a9}","0{aa}","0{ab}"),r=El("div","rl"),d=El("div","rl"),l=El("div","grad"),s=l.ap(El("div"));css([r,d],{paddingLeft:"8px"}),s.crt=function(t,o,i){let e=this.ap(El("div","gradc"));css(e,{left:t,background:o}),e.s=i,e.onmousedown=function(t){let o=this.pN;t.button?o.ch.length>2&&(this.remove(),o.ref()):(this.d=t.x-this.offsetLeft,o.d=this)},e.ondblclick=function(t){css(UI.ipc,{left:`${t.x}px`,top:`${t.y}px`}),UI.ipc.onchange=()=>{this.style.background=UI.ipc.value,this.s=UI.ipc.value.slice(1)+this.s.slice(6),this.pN.ref()},UI.ipc.value="#"+this.s.slice(0,6),setTimeout(()=>UI.ipc.click(),1)}},s.ref=function(){let t=this.ch,o=[];for(let i=0;i<t.length;i++)o.push(t[i].s);this.pN.set(o.toString(),1,1)},s.onmousedown=function(t){if(t.target!==this||t.button)return;let o=this.getBoundingClientRect(),i=((t.x-o.left)/160).toFixed(2),e=this.pN;e.set(e.v+",ffffff "+i,1,1),this.crt(100*i+"%","#ffffff","ffffff "+i)},s.onmousemove=function(t){if(this.d){let o=Math.mM((t.x-this.d.d)/160,0,1).toFixed(2);this.ch,this.d.style.left=100*o+"%",this.d.s=this.d.s.slice(0,7)+o,this.ref()}},s.onmouseleave=s.onmouseup=function(){this.d=null},l.set=function(t,o,i){let e=t.split(","),r="",d=this.firstChild;if(!o)for(let t=d.ch.length;t--;)d.ch[t].remove();e.sort((t,o)=>t.slice(7)-o.slice(7)),this.v=t,e.for(t=>{let i=100*t.slice(7)+"%",e="#"+t.slice(0,6);r+=e+" "+i+",",o||d.crt(i,e,t)}),this.style.background="linear-gradient(90deg,"+r.slice(0,-1)+")",i&&Res.loadBg({m:3+this.pS().v,g:(1===this.pS().v?this.nS().v+":":"")+this.v}).then(t=>{$E._r.setBg(t),$E._r.drawBg()})},l.set("000000 0,ffffff 1"),r.ap(UI.C("0{ac}",0,"0{ad}","0{ae}").on(t=>{let o=r.ch[2],i=$E._r.bg.g.split(":"),e=(1===t?o.v+":":"")+i.at(-1);Res.loadBg({m:t+3,g:e}).then(t=>{$E._r.setBg(t),$E._r.drawBg()}),1===t?o._s():o._h()}),l,UI.I("0{af}",{type:"number",m:0,M:360,value:270}).on(t=>Res.loadBg({m:4,g:t+":"+$E._r.bg.g.split(":")[1]}).then(t=>{$E._r.setBg(t),$E._r.drawBg()}))),r.firstChild.style.display="inline-block",r.firstChild.set(1),d.ap(UI.span("0{ab}"),UI.B2("0{ag}").on(()=>$E.ThmLib.showSpr("bg")),UI.C("0{ac}",0,"0{ah}","0{ai}","0{aj}").on(t=>{$E._r.bg.m=t/2|0,$E._r.drawBg()}),UI.R("0{ak}",0,359,0).on(t=>$E._r.colBg(t,"","","")),UI.R("0{al}",0,100,50).on(t=>$E._r.colBg("","",t,"")),UI.R("0{am}",0,100,50).on(t=>$E._r.colBg("",t,"","")),UI.R("0{an}",-100,100,50).on(t=>$E._r.colBg("","","",t))),css(d.ch[2],{float:"right",marginRight:"10px"}),i.style.display="inline-block",i.on((t,o)=>{let l=i.nS(2);l._h(),r._h(),d._h();const s=$E._r.bg;switch(t){case 1:l._s(),1!==o&&l.f(l.c(l.lastChild.style.background)||"#fff");break;case 2:r._s();let t=r.ch;if(5===s.m?t[2]._h():t[2]._s(),1===o){if(4===s.m){let o=s.g.split(":");t[1].set(o[1]),t[2].set(o[0])}else t[1].set(s.g);t[0].set(s.m-3)}else t[1].set(t[1].v,0,1);break;case 4:d._s();let i=d.ch;if(1===o){let t=(s.g||"").split(",");i[1].v=s.id,i[2].set(1<<s.m),i[3].set(t[0]),i[5].set(t[1]),i[4].set(t[2]),i[6].set(t[3])}else{let t={id:i[1].v??0,m:i[2].v/2|0,g:i[3].v+","+i[5].v+","+i[4].v+","+i[6].v};dac($("box"),""),Res.loadBg(t,1).then(t=>{$E._r.setBg(t),$E._r.drawBg(),ac($("box"))},Res.fail)}}$E.fixH(e[4])});let n=El("div","rl");$E.tileCol=n,n._h(),Object.defineProperty(n,"spr",{get(){return this._spr},set(t){t!==this._spr&&(this._spr=t,t?(this.loadCol(t),this._s()):(this._h(),css($c("spr"),{outline:""})),$E.fixH($c("cat")[4]))}}),n.setCol=function(...t){if(this.spr&&Res.spr[this.spr]){if($E._r.col){for(let o in $E._r.col){let i=$E._r.col[o].split("|");if(i.includes(this.spr)){if(o.split(",").for((o,i)=>{""===t[i]&&(t[i]=o)}),i.length>1){let t=[];i.for(o=>{o!==this.spr&&t.push(o)}),$E._r.col[o]=t.join("|")}else delete $E._r.col[o];break}}if(t=Res.color.gen(t)){let o=!0;for(let i in $E._r.col)if(i===t){$E._r.col[i]+="|"+this.spr,o=!1;break}o&&($E._r.col[t]=this.spr)}}else(t=Res.color.gen(t))&&($E._r.col={},$E._r.col[t]=this.spr);this.col=t,Res.colSpr(Res.spr[this.spr],t).then(()=>{$E.drawThn($("tile").spr[this.spr],Res.spr[this.spr]),$E.sfO.redraw()})}},n.loadCol=function(t){let o=[0,50,50,50],i=this.ch;if(this.col="",$E._r.col)for(let i in $E._r.col)if($E._r.col[i].split("|").includes(t)){i.split(",").for((t,i)=>{""!==t&&(o[i]=Number(t))}),this.col=i;break}i[2].set(o[0]),i[3].set(o[2]),i[4].set(o[1]),i[5].set(o[3])};let c=El("div");c.id="tile",c.spr={},c.skip=["pst","dko","dkf","son","sof","gp","ist","ifg","txt"];let a=[...Res.sprList];a.splice(53,1),a.splice(30,0,"cvr"),a.for(t=>{c.skip.includes(t)||(c.spr[t]=c.ap(El("canvas","spr",{width:32,height:32})),c.spr[t].spr=t,c.spr[t].onclick=function(t){let o=t.ctrlKey?n.col:void 0;if(css($c("spr"),{outline:""}),css(this,{zIndex:1,outline:"1px solid #fd0"}),n.spr=this.spr,void 0!==o){o=(o||"0,50,50,50").split(","),n.setCol(...o);let t=n.ch;t[2].set(o[0]),t[3].set(o[2]),t[4].set(o[1]),t[5].set(o[3])}})}),n.ap(UI.span("0{ao}"),UI.B2("0{ag}").on(()=>$E.ThmLib.showSpr(n.spr)),UI.R("0{ak}",0,359,0).on(t=>n.setCol(t,"","","")),UI.R("0{al}",0,100,50).on(t=>n.setCol("","",t,"")),UI.R("0{am}",0,100,50).on(t=>n.setCol("",t,"","")),UI.R("0{an}",-100,100,50).on(t=>n.setCol("","","",t)),UI.p("*0{ap}")),e[4].ap(UI.span("0{aq}"),UI.B2("0{ag}").on(()=>$E.ThmLib.show()),El("br"),i,UI.span(" "),UI.Col("0{ar}").on(t=>{$E._r.setBg({m:3,g:t}),$E._r.drawBg()}),r,d,UI.p("0{as}"),c,n),Au.onready(()=>$E.bgm=new Au.Bgm);let E=El("div")._c(UI.Play(1).on(t=>t?$E.bgm.play():$E.bgm.pause()),UI.R("0{at}",0,100,100,1,"var(--cbtl)").on(t=>{$E.bgm.vol=t,$E._r.bgm.v=t}),UI.S("0{au}",1,1).on(t=>$E._r.bgm.a=t),UI.S("0{av}",1,1).on(t=>$E._r.bgm.l=t),UI.S("0{aw}",0,1).on(t=>$E._r.bgm.s=t));E.firstChild.id="bgmPv",e[5].ap(UI.span("0{ax}"),UI.O("0{ay}","0{az}","0{b0}","0{b1}").on(t=>{let o=$E._r.bgm,i=$c("block",e[5]);if(o.m=t,css(i,{display:"none"},t,{display:""}),t<2)E._h();else{E._s(),$E.bgm.au.preload="none";let t=i[o.m].ch;t[0].set(o.i??""),t[0].f(o.i??"","none"),t=E.ch,t[0].hC("p")&&t[0].click(),t[1].set(o.v),t[1].f(o.v??100),t[2].set(o.a??1),t[3].set(o.l??1),t[4].set(o.s)}$E.fixH(e[5])}),El("div","block")._c(UI.span("*0{b2}")),El("div","block")._c(UI.span("*0{b3}")),El("div","block")._c(UI.I("0{b4}",0,300).on((t,o="auto")=>{$E._r.bgm.i=t,$E.bgm.au.preload=o,$E.bgm.url=t,$E.bgm.au.onerror=()=>t&&UI.$a("0{b5}")})),El("div","block")._c(UI.I("0{b6}",0,112).on((t,o="auto")=>{$E._r.bgm.i=t,$E.bgm.au.preload=o,$E.bgm.url=t?`https://music.163.com/song/media/outer/url?id=${t}.mp3`:"",$E.bgm.au.onerror=()=>t&&UI.$a("0{b7}")}),UI.span("*0{b8}https://music.163.com/#/song?id=<b>22776365</b>")),E),css($c("block",e[5]),{display:"none"},0),E._h(),e[7].ap($E.BObj("ply","0{b9}","ply"),$E.BObj("gov","GameOver","txt",[1,1,1,1])),e[8].ap($E.O(0),$E.O(1,1),$E.O(2,1)),e[9].ap($E.O(3,1),$E.O(4),$E.O(5,1),$E.O(6,1),$E.O(50,1)),e[10].ap($E.O(7,1,1),$E.O(8,1),$E.O(9,1),$E.O(11,0,1),$E.O(12)),e[11].ap($E.O(10),$E.O(13,1,1),$E.O(14,1,1),$E.O(15),$E.O(16),$E.O(49),$E.O(17),$E.O(18),$E.O(19),$E.O(25,0,0,1),$E.O(20),$E.O(51),$E.O(21,1,0,1),$E.O(22),$E.O(23,0,1),$E.O(24,0,1)),e[12].ap($E.O(26),$E.O(27),$E.O(28),$E.O(29),$E.O(30),$E.O(31),$E.O(32),$E.O(33),$E.O(34),$E.O(35)),e[13].ap($E.O(36,1),$E.O(37,0,1),$E.O(38,0,0,1)),e[14].ap($E.O(39),$E.O(40,1,1),$E.O(41),$E.O(42),$E.O(43,1),$E.O(44,1,0),$E.O(45,1),$E.O(46,1),$E.O(47,1),$E.O(48,1,0)),e[18].firstChild.ap(UI.help("0{1h}")),e[19].firstChild.ap(UI.help("0{1j}"));for(let t=0;t<12;t++)e[19].ap(UI.span(`${UI.ico("layer")} 0{1j}${t}${11===t?"(GUI)":""} `),UI.S("0{ba}",1,1).on((o,i)=>{$E.C.vLy(t,o),o&&"sw"!==i.nS().lastChild.className||$E.C.lkLy(t,!o)}),UI.S(" 0{bb}",0,1).on(o=>$E.C.lkLy(t,o)),El("br"));e.for((t,o)=>$E.fixH(t,t=>{$S.get("cat"+o)&&t.aC("fold"),t.firstChild.onclick=()=>{t.hC("fold")?(t.rC("fold"),$S.rm("cat"+o)):(t.aC("fold"),$S.set("cat"+o,1))}}));let p=$("htrack"),f=$("vtrack");$("hbar").onmousedown=function(t){this.pN.drag=t.x-this.style.transform.slice(11,-3)},$("vbar").onmousedown=function(t){this.pN.drag=t.y-this.style.transform.slice(11,-3)},p.onmousemove=function(t){this.drag&&($E._r.editX=Math.mM((t.x-this.drag)/this.clientWidth*$E._r.w|0,0,$E._r.w-800),$E._r.setBar())},f.onmousemove=function(t){this.drag&&($E._r.editY=Math.mM((t.y-this.drag)/this.clientHeight*$E._r.h|0,0,$E._r.h-608),$E._r.setBar())},p.onmouseleave=p.onmouseup=f.onmouseleave=f.onmouseup=function(){this.drag=0}})}$E.import={ciwp:(t,o)=>Ipc.zip(t.split(",").at(-1),2,t=>{try{let i=JSON.parse(t);if(!i.R)throw 0;if(o)return $E.setGame(i);(new UI.M).t("0{bc}").b("0{bd}","0{be}").then(t=>{if(t.i){if($E._R.length+i.R.length>128)return UI.$a("0{bf}");i._s&&i._s.for(t=>{$E.GAME._s?.find(o=>o.c===t.c&&o.h===t.h)||$E.GAME._s.push(t)});for(let t in i.VAR)void 0===$E.GAME.VAR[t]&&$E.addVar(t);let t=[];for(let o=128;o--;)t.push(0);$E._R.for(o=>t[o.id]=1),i.R.for(o=>{o.type<2&&$E._R.find(t=>t.type===o.type)||(o.id=t.indexOf(0),o.id<128&&o.id>=0&&(t[o.id]=1,$E.addRoom(new $E.Room(o.type,o))))}),UI.$a("0{bg}")}else $E.setGame(i)})}catch{UI.$a("0{bh}")}})},$E.import.jmap=t=>{let o=t.split("\n");if(o[11]){$E.C._U(),$E._r.obj=($E._r.flag?.[2]??"|").repeat($E._r.ly.length-1),$E._r.dec(),$E.$O&&$E.$P();const t=o[4].split(" "),i=[0,Lib.obj[3],Lib.obj[4],Lib.obj[7],{...Lib.obj[7],ang:270},{...Lib.obj[7],ang:90},{...Lib.obj[7],ang:180},{...Lib.obj[7],scx:.5,scy:.5},{...Lib.obj[7],ang:270,scx:.5,scy:.5},{...Lib.obj[7],ang:90,scx:.5,scy:.5},{...Lib.obj[7],ang:180,scx:.5,scy:.5},Lib.obj[8],Lib.obj[2],Lib.obj[13],Lib.obj[16],Lib.obj[15],{...Lib.obj[14],ang:180},Lib.obj[14],Lib.obj[9],Lib.obj[50],Lib.obj[0],Lib.obj[1],Lib.obj[25],Lib.obj[49]];for(let o=0;o<t.length;o++){let e=Number(t[o++]),r=Number(t[o++]),d=i[t[o]];if(d){switch(d.ang){case 90:r+=32*(d.scx||1);break;case 180:e+=32*(d.scx||1),r+=32*(d.scy||1);break;case 270:e+=32*(d.scy||1)}let t=new $E.E(e,r,d);$E.sfO.$d(t.LT[0],t.LT[1],t.w,t.h)}}$E._r.setNum(),$E.sfO.update()}else UI.$a("0{bh}")},$E.C={mX:0,mY:0,mTX:0,mTY:0,mPX:0,mPY:0,mB:0,lkLy(t,o){$E._r.ly[t].lock=o},vLy(t,o){$E._r.ly[t].vis=o,$E.sfO.redraw()},pRc(t,o,i,e,r,d){return t>=i&&o>=e&&t<r&&o<d},cRc(t,o,i,e,r,d,l,s){return t+i>r&&t<r+l&&o+e>d&&o<d+s},atPosDep(t,o,i){return $E._r.ly[i].lock?null:$E._r.ly[i].find(i=>i.x===t&&i.y===o)},colPosDep(t,o,i){if($E._r.ly[i].lock)return-1;for(let e=$E._r.ly[i].length;e--;){let r=$E._r.ly[i][e],d=r.R,l=d[0],s=d[1];if(l<=t&&l+r.w>t&&s<=o&&s+r.h>o)return e}return-1},colPosObj(t,o){for(let i=$E._r.ly.length;i--;){let e=this.colPosDep(t,o,i);if(-1!==e)return $E._r.ly[i][e]}return null},cXY(){const t=$E._O;let o=this.mX,i=this.mY;if(t)if(1===t.a)o+=16,i+=t.spr[0].y?16:0;else if(!Lib.spr[t.spr[0].name]?.x&&!Lib.spr[t.spr[0].name]?.y)switch(t.o.ang){case 90:i+=32*(t.o.scx??1);break;case 180:o+=32*(t.o.scx??1),i+=32*(t.o.scy??1);break;case 270:o+=32*(t.o.scy??1)}return[o,i]},dLine(t,o,i,e,r="#f5d"){const d=$E.sfE;d.strokeStyle=r,d.lineWidth=2,d.beginPath(),d.moveTo(t,o),d.lineTo(i,e),d.stroke(),d.lineWidth=1,d.$d(Math.min(i,t)-2,Math.min(e,o)-2,Math.abs(i-t+4),Math.abs(e-o+4))},dSelect(t,o,i,e,r="#fd5"){const d=$E.sfE;d.strokeStyle="#000",d.strokeRect(t-.5,o-.5,i+1,e+1),d.strokeRect(t-2.5,o-2.5,i+5,e+5),d.strokeStyle=r,d.strokeRect(t-1.5,o-1.5,i+3,e+3),d.$d(t-3,o-3,i+6,e+6)},dM(t,o,i,e,r,d,l,s){if($E.pro.lock||$E.inEdit)return;const n=$E._O,c=$E.sfE;if(c.clear(),!i&&n&&($E.$O&&$E.$O.some(t=>{let o=t.R,i=o[0],e=o[1];return this.pRc(this.mTX,this.mTY,i,e,i+t.w,e+t.h)})&&(i=!0),!i)){void 0===e&&(e=t,r=o,d=32,l=32,s=32);let i=e+d,a=r+l;n.spr.for(t=>{for(let o=r;o<a;o+=s)for(let r=e;r<i;r+=s)if("blk"===t.name||"tile"===t.name)(n.o.scx<1||n.o.scy<1)&&$E.eSmth(c),c.drawImage(t[0],0,0,32,32,r,o,32*n.o.scx,32*n.o.scy),$E.dSmth(c),c.$d(r,o,32*n.o.scx,32*n.o.scy);else{let i=n.o.scx??1,e=n.o.scy??1;if(n.o.ang){$E.E.dE(c,t,0,r,o,i,e,n.o.ang,t.x,t.y);let d=[];Core.calcBox({x:r,y:o,scx:i,scy:e,ang:n.o.ang},t.w*i,t.h*e,t.x,t.y,[],d,[]),c.$d(d[0],d[1],d[2]-d[0],d[3]-d[1])}else 1!==i||1!==e?($E.E.dS(c,t,0,r,o,i,e,t.x,t.y),c.$d(r-t.x*i,o-t.y*e,t.w*i,t.h*e)):(c.drawImage(t[0],r-t.x,o-t.y),c.$d(r-t.x,o-t.y,t.w,t.h))}})}$E.$O&&($E.$O.for(t=>{t.dInfo&&t.dInfo()}),c.strokeStyle="#000",$E.$O.for(t=>{let o=t.R[0],i=t.LT[1],e=t.w,r=t.h;c.strokeRect(o-.5,i-.5,e+1,r+1),c.strokeRect(o-2.5,i-2.5,e+5,r+5),c.$d(o-3,i-3,e+6,r+6)}),c.strokeStyle="#fd5",$E.$O.for(t=>c.strokeRect(t.LT[0]-1.5,t.LT[1]-1.5,t.w+3,t.h+3))),i&&void 0!==e&&this.dSelect(e,r,d,l)},delPos(t,o){let i=this.colPosObj(t,o),e=!1;if(i){let t=i.dep;if($E.$O)for(let t=$E.$O.length;t--;)if($E.$O[t]===i){$E.$O.splice(t,1),$E.$P($E.$O.length?$E.$O:0),e=!$E.$O;break}$E._r.ly[t].rm(i),$E._r.setNum(),$E.sfO.update()}return e},moveEditO(t,o){$E.$O.for(i=>{if(i.gO()?.add.gpm[0])return;10===i.ind&&i.mG(t,o);let{w:e,h:r}=i;$E.sfO.$d(i.R[0],i.LT[1],e,r),i.x+=t,i.y+=o,i.tile&&$E.E.rTile(i.x-t,i.y-o,e,r,i),$E.sfO.$d(i.LT[0],i.LT[1],e,r)}),$("edit-x")?.set($E.$O[0].x),$("edit-y")?.set($E.$O[0].y),$E.sfO.update(),this.dM(0,0,1)},editDo(){if($E.$O){if($E.pro.lock)return $E.$O[0].id;let t=$E._r.ly.map(()=>[]);return t.first=[$E.$O[0].dep,$E.$O[0].sid],$E.$O.slice(1).for(o=>t[o.dep].push(o.sid)),t}return null},editPos(){let t=$c("page")[3],o=$c("p-ev",t),i=$c("p-ac",t),e={top:t.scrollTop,ev:[],pac:[]};return o.for(t=>e.ev.push(t.hC("fold"))),i.for(t=>{t.hC("fold")&&e.pac.push(t._id)}),e},rcPos(t){let o=$c("page")[3],i=$c("p-ev",o),e=$c("p-ac",o);o.scrollTop=t.top,i.for((o,i)=>{t.ev[i]?o.aC("fold"):o.rC("fold")}),e.for(o=>{t.pac.includes(o._id)?o.aC("fold"):o.rC("fold")})},_U(){if(!$E._r)return;let t=$E._r,o=t.enc(),i=t.encB(),e=t.undo.at(-1);e&&o===e.code&&i===e.bobj||(t.redo.length=0,t.undo.push({code:o,bobj:i,edit:this.editDo(),pos:this.editPos()}),t.undo.length>App.gC("edit","undoDepth")&&t.undo.shift())},aplDo(t,o){t.obj=o.code,t.dec(),t.decB(o.bobj),o.edit?("string"==typeof o.edit?$("bi-"+o.edit).click():($E.pro.lock=!1,$E.$O=[t.ly[o.edit.first[0]][o.edit.first[1]]],o.edit.for((o,i)=>o.for(o=>$E.$O.push(t.ly[i][o]))),$E.$P($E.$O)),this.rcPos(o.pos)):$E.$P()},undo(){if(!$E._r)return;let t=$E._r,o=t.undo.pop(),i=t.enc(),e=t.encB();for(;o?.code===i&&o?.bobj===e;)o=t.undo.pop();o&&(t.redo.push({code:i,bobj:e,edit:this.editDo(),pos:this.editPos()}),this.aplDo(t,o))},redo(){if(!$E._r)return;let t=$E._r,o=t.redo.pop();o&&(t.undo.push({code:t.enc(),bobj:t.encB(),edit:this.editDo(),pos:this.editPos()}),this.aplDo(t,o))},clipBoard:[],copy(t){this.clipBoard.length=0;let o=Infinity,i=Infinity;t.for(t=>{t.x<o&&(o=t.x),t.y<i&&(i=t.y)}),t.for(t=>this.clipBoard.push({x:t.x-o,y:t.y-i,ind:t.ind,add:$M.cp(t.add)}))},paste(t,o){if(!this.clipBoard.length)return;this._U(),$E.pro.lock=!1,$E.$O=[];let i={},e=[];this.clipBoard.for(r=>{let d=r.add.gid,l={...Lib.obj[r.ind]};l.add={...Lib.obj[r.ind].add,...r.add},delete l.add.gid;let s=new $E.E(t+r.x,o+r.y,l);$E.$O.push(s),d&&(i[d]=s),l.add.gpi&&e.push(s)}),e.forEach(t=>{for(let o in i)if(t.add.gpi.startsWith(o))return t.add.gpi=t.add.gpi.replace(o,i[o].add.gid);delete t.add.gpi}),$E._r.setNum(),$E.sfO.redraw(),$E.$P($E.$O)}},docReady.then(()=>{const t=$("screen");t.get=()=>{let o=t.getBoundingClientRect();t.left=o.left+32,t.top=o.top+32},window.onresize=t.get,t.get(),t.onmousedown=o=>{if(!$E.edit)return;const i=$E.C;if(i.mB=o.button,i.mB&&o.preventDefault(),o.stopPropagation(),$E._r){if(t.dX=i.mX,t.dY=i.mY,t.drag=!0,$E.inEdit)return $E.editClick(o,t);if(0===i.mB){if(o.ctrlKey){let t=i.colPosObj(i.mTX,i.mTY);t&&$E.$O&&$E.$O.includes(t)||(t?$E.pro.lock?($E.pro.lock=!1,$E.$O=[t]):$E.$O?$E.$O.push(t):$E.$O=[t]:$E.$O=null,$E.$O?($E.tab[3].click(),$E.$P($E.$O)):$E.$P())}else if($E.$O){let t=i.colPosObj(i.mTX,i.mTY);$E.$O.includes(t)?($E.$O.drag=t,i._U()):$E.$P()}if($E._O&&!$E.$O&&!o.ctrlKey&&!o.shiftKey){let[o,e]=i.cXY(),r=$E._O.dep;if($E._r.ly[r].lock)UI.$a($E._r.ly[r].vis?"0{bi}":"0{bj}"),t.drag=!1,t.out=!0;else if(!i.atPosDep(o,e,r)){i._U();let t=new $E.E(o,e,$E._O.o);$E._r.setNum(),$E.sfO.$d(t.R[0],t.LT[1],t.w,t.h),$E.sfO.update()}}}else if(2===i.mB)if(o.ctrlKey){if($E.$O&&!$E.pro.lock){let t=i.colPosObj(i.mTX,i.mTY);if(t)for(let o=$E.$O.length;o--;)if($E.$O[o]===t){$E.$O.splice(o,1),$E.$P($E.$O.length?$E.$O:0);break}}}else i._U(),(i.delPos(i.mTX,i.mTY)||$E.$O)&&$E.$O&&$E.$P();else 1===i.mB&&(t.style.cursor="grab",i.dM(0,0,1))}},t.outf=()=>{const o=$E.C;if(t.drag=!1,t.style.cursor="",$E.$O&&($E.$O.drag=null),!o.mB){if(t.slc){$E.$O&&!$E.pro.lock||($E.pro.lock=!1,$E.$O=[]);let[i,e,r,d]=t.slR();for(let t=$E._r.ly.length;t--;)if(!$E._r.ly[t].lock)for(let l=$E._r.ly[t].length;l--;){let s=$E._r.ly[t][l],[n,c]=s.R;o.cRc(n,c,s.w,s.h,i,e,r,d)&&!$E.$O.includes(s)&&$E.$O.push(s)}return $E.$P($E.$O.length?$E.$O:0),t.slc=!1,!0}if(t.fill){let i=$E._O.dep,e=t.fR;if(!$E._r.ly[i].lock){let t=e[0]+e[2],r=e[1]+e[3],d=e[4];o._U();for(let l=e[1];l<r;l+=d)for(let r=e[0];r<t;r+=d)if(!o.atPosDep(r,l,i)){let t=new $E.E(r,l,$E._O.o);$E.sfO.$d(t.R[0],t.LT[1],t.w,t.h)}$E._r.setNum()}return t.fill=!1,o.dM(0,0,1),$E.sfO.update(),!0}}},t.onmouseup=o=>{$E.edit&&(o.preventDefault(),t.outf())},window.addEventListener("mouseup",()=>t.drag=!1),t.slR=()=>{let o,i,e=$E.C.mX-t.dX,r=$E.C.mY-t.dY;return e>0?o=t.dX:(o=$E.C.mX,e=-e),r>0?i=t.dY:(i=$E.C.mY,r=-r),[o,i,e+$E.grid.value,r+$E.grid.value]},t.onmousemove=o=>{if(!$E.edit)return;if(o.stopPropagation(),t.out=!1,!$E._r)return;const i=$E.C,e=$E.$O,r=$E.grid.value;let d="";if(i.mTX=o.x-t.left+$E._r.editX|0,i.mTY=o.y-t.top+$E._r.editY|0,i.mPX=i.mX,i.mPY=i.mY,i.mX=o.altKey?i.mTX:Math.floor(i.mTX/r)*r,i.mY=o.altKey?i.mTY:Math.floor(i.mTY/r)*r,UI.showTips(i.mX+","+i.mY,o.x+8,o.y-32),$E.inEdit)return $E.editMove(o,t);if(t.drag)if(0===i.mB)if(o.ctrlKey)i.mPX===i.mX&&i.mPY===i.mY&&t.slc||(t.slc=!0,i.dM(0,0,1,...t.slR())),e&&(e.drag=null);else{if(e&&e.drag){let t=i.mX-e.drag.x,o=i.mY-e.drag.y;(t||o)&&i.moveEditO(t,o)}t.slc&&(t.slc=!1,i.dM(0,0,1))}else if(2===i.mB)o.ctrlKey||i.delPos(i.mTX,i.mTY);else if(1===i.mB){let t=Math.mM($E._r.editX-o.movementX,0,$E._r.w-800),i=Math.mM($E._r.editY-o.movementY,0,$E._r.h-608);t===$E._r.editX&&i===$E._r.editY||($E._r.editX=t,$E._r.editY=i,$E._r.setBar()),d="grab"}if($E._O&&!o.ctrlKey&&1!==i.mB&&(i.mPX!==i.mX||i.mPY!==i.mY)){let[r,d]=i.cXY();if(t.drag&&0===i.mB&&1!==$E._O.o.ind&&!e)if(o.shiftKey)t.fR=t.slR(),t.fR[4]=($E._O.o.scx??1)*("0{57}"===$E._O.name?16:32)|0,t.fR[0]+=r-i.mX,t.fR[1]+=d-i.mY,i.dM(r,d,0,...t.fR),t.fill=!0;else{t.fill=!1,i.dM(r,d);let o=$E._O.dep;if(!i.atPosDep(r,d,o)&&!$E._r.ly[o].lock){let t=new $E.E(r,d,$E._O.o);$E._r.setNum(),$E.sfO.$d(t.R[0],t.LT[1],t.w,t.h),$E.sfO.update()}}else if(!e||!e.drag){if(7===$E._O.o.ind&&App.gC("edit","autoSpk")){r=i.mX,d=i.mY;const t=(t,o,i)=>{let e=-1===t?r:r+t,l=-1===o?d:d+o;for(let r=$E._r.ly.length;r--;)if($E._r.ly[r].find(r=>{if(7===r.ind&&(r.ang??0)===i)if(-1===t||-1===o){let i=r.R,d=i[0],s=i[1];if(-1===o&&d===e&&s===l-r.h)return!0;if(-1===t&&d===e-r.w&&s===l)return!0}else if(r.x===e&&r.y===l)return!0;return!1}))return!0},o=(t,o)=>{t+=r,o+=d;for(let i=$E._r.ly.length;i--;)for(let e=$E._r.ly[i].length;e--;){let r=$E._r.ly[i][e];if(3!==r.ind)continue;let d=r.R,l=d[0],s=d[1];if(l<=t&&l+r.w>t&&s<=o&&s+r.h>o)return!0}};let e=-1,l=32*$E._O.o.scx,s=l/2;t(0,l,180)?e=0:t(0,-1,0)?e=180:t(-1,0,90)?e=270:t(l,0,270)?e=90:o(s,l)?e=0:o(s,-1)?e=180:o(-1,s)?e=270:o(l,s)&&(e=90),-1!==e&&($E._O.lastChild.style.transform=`rotate(-${e}deg)`,$E._O.o.ang=e),[r,d]=i.cXY()}i.dM(r,d),t.fill=!1}}t.style.cursor=d},t.onwheel=t=>{if(!$E.edit||$E.inEdit)return;let o=Math.sign(t.wheelDelta);if(t.ctrlKey);else if($E._O){let t=.25*o;$E._O.o.scx+t>=.5&&$E._O.o.scx+t<=5&&($E._O.o.scx+=t,$E._O.o.scy+=t,$E.C.dM(...$E.C.cXY()),UI.showTips($E.C.mX+","+$E.C.mY+" ×"+$E._O.o.scx.toFixed(2)))}},t.onmouseout=()=>{$E.edit&&(UI.tip._h(),t.out=!0,t.outf()||$E.C.dM(0,0,1))},doc.addEventListener("keydown",o=>{let i=doc.activeElement.tagName;if(!$E.edit&&!$R)return;if(o.ctrlKey&&90===o.keyCode&&o.preventDefault(),"TEXTAREA"===i||"INPUT"===i)return;const e=!o.repeat,r=o.keyCode;if($E.edit){if($E.inEdit)return;const i=$E.C;if(r>47&&r<58){let o=$("hObj"+r);i.hObj?(o?.setKey(),i.hObj.setKey(r,1)):(o?.click(),t.out||i.dM(...i.cXY()))}else switch(r){case 9:e&&$E._r&&(i.hObj=null,$E.tab[($E.nowTab+1)%4].click());break;case 17:e&&!t.out&&$E._O&&(t.fill=!1,i.dM(0,0,1));break;case 90:o.ctrlKey&&(o.shiftKey?i.redo():i.undo());break;case 87:case 65:case 83:case 68:if(e)if(o.ctrlKey)if(65===r){$E.pro.lock=!1,$E.$O=[];for(let t=$E._r.ly.length;t--;)if(!$E._r.ly[t].lock)for(let o=$E._r.ly[t].length;o--;)$E.$O.push($E._r.ly[t][o]);$E.$P($E.$O.length?$E.$O:0)}else 83===r&&$("btn").ch[2].click();else if($E._O&&void 0!==$E._O.o.ang){let o=87===r?0:65===r?90:83===r?180:270;switch($E._O.o.spr[0]){case"btn":case"arr":o=(o+90)%360;break;case"wj":o=(o+270)%360}$E._O.lastChild.style.transform=`rotate(-${o}deg)`,$E._O.o.ang=o,t.out||i.dM(...i.cXY())}break;case 67:e&&o.ctrlKey&&$E.$O&&!$E.pro.lock&&i.copy($E.$O);break;case 86:e&&o.ctrlKey&&!t.out&&$E._r&&i.paste(...i.cXY());break;case 71:e&&$("setg").click();break;case 37:case 38:case 39:case 40:o.preventDefault(),$E.$O&&(e&&i._U(),i.moveEditO(37===r?-$E.grid.value:39===r?$E.grid.value:0,38===r?-$E.grid.value:40===r?$E.grid.value:0));break;case 88:if(!(e&&o.ctrlKey&&$E.$O)||$E.pro.lock)break;i.copy($E.$O);case 8:case 46:e&&$E.$O&&!$E.pro.lock&&(i._U(),$E.$O.for(t=>$E._r.ly[t.dep].rm(t)),$E._r.setNum(),$E.sfO.update(),$E.$P())}}else if(o.ctrlKey&&e)switch(r){case 71:$R.god=!$R.god;break;case 83:$R.$&&$R.save()&&(new Core.P($R.$.x-1,$R.$.y-7,Res.spr.sp,6).aspd=.05)}}),doc.addEventListener("keyup",o=>{$E.edit&&17===o.keyCode&&(!t.out&&$E._O?$E.C.dM(...$E.C.cXY()):t.slc&&(t.slc=!1,$E.C.dM(0,0,1)))})});