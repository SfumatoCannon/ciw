$S.srm("fetch"),USER&&DB.User.logOut();{let A="",e=$c("tab"),t=$c("cat"),r=$c("btn"),a=$t("input",$("login")),s=$c("see"),n=$c("info");if(t[0].ap(UI.S("记住我",App.gC("app","rmb")).on(A=>App.sC("app","rmb",A))).id="save",App.gC("app","rmb")&&$S.get("rmbUser"))try{let A=JSON.parse(atob($S.get("rmbUser")));for(let e=0;e<2;e++)a[e].value=decodeURIComponent(A[e])}catch{$S.rm("rmbUser")}e.for((A,r)=>{A.onclick=()=>{A.style.background&&(t[r]._s(),t[1-r]._h(),css(e,{background:"var(--dac)"},r,{background:""}),css($("login"),r?{height:"390px",transform:"translateY(-20px)"}:{height:"",transform:""}))}}),a.for((A,e)=>A.oninput=()=>n[e<2?0:1]._h());const i=e=>{A&&UI.check(e,"验证").then(e=>{25===e.v.length?$M.xhr("GET",`${DB.serverURL}/apps/ciw-api/verify_email?token=${encodeURIComponent(e.v)}&username=${encodeURIComponent(A)}`).then(A=>{A.responseURL.slice(27).startsWith("verify?")?UI.alert("账号验证成功"):o("验证码错误或已失效")},()=>o("账号验证失败")):o("验证码错误")})},o=A=>{(new UI.M).t(A).b("重试","取消").then(A=>{A.i||i("请输入邮件中的验证码以完成账号验证：")})};r[0].onclick=()=>{a[0].value.trim()&&a[1].value.trim()&&(r[0].aC("gray"),A=a[0].value,DB.User.logIn(A,a[1].value).then(async A=>{if($S.srm("offline"),App.gC("app","rmb")){let A=[];for(let e=0;e<2;e++)A[e]=encodeURIComponent(a[e].value);$S.set("rmbUser",btoa(JSON.stringify(A)))}else $S.rm("rmbUser");if(A.get("p")&&A.get("m"))LOC("home");else{A.set("p",DB.O("UserPvt")),A.set("m",DB.O("UserMsg"));try{await A.save(),LOC("home")}catch(A){n[0].tx("用户初始化失败")._s(),console.error(A),r[0].rC("gray")}}},A=>{let e;switch(A.code){case 101:e=A.message.startsWith("Invalid")?"用户名或密码错误":A.message.startsWith("Your account is locked")?"登录失败次数过多，请15分钟后再次尝试":"登录失败";break;case 205:return UI.confirm("您的账号尚未验证，是否重新发送验证邮件？").then(A=>{if(A.i)return r[0].rC("gray");UI.prompt("请输入注册的邮箱地址").then(A=>{A.i||A.v.match(/[^@]+@.+\..+/)&&DB.User.requestEmailVerification(A.v).then(()=>i("验证邮件已发送到您的邮箱，请输入邮件中的验证码以完成账号验证：")),r[0].rC("gray")})});default:e="登录失败"}n[0].tx(e)._s(),r[0].rC("gray")}))},a[2].onchange=function(){this.value=this.value.trim()},r[1].onclick=()=>{let t=a[2].value,s=a[3].value,o=a[4].value.trim();if(!t||!s||!o)return;if(t.length<2||t.length>20)return n[1].tx("用户名应为2～20字符")._s();let g=t.match(/\d+/);if(g&&g[0]===t)return n[1].tx("用户名不能为纯数字")._s();for(let A=0;A<t.length;A++)if(t.codePointAt(A)>65535)return n[1].tx("无效的用户名")._s();return s.length<6||s.length>16?n[1].tx("密码应为6～16字符")._s():o.match(/[^@]+@.+\..+/)?void(new UI.M).h("Cloud I Wanna 用户守则").t("Cloud I Wanna 用户须遵守以下规则：").t("-禁止任何方式的游戏作弊，包括但不限于代码修改、变速工具、按键脚本、一键JC").t("-禁止恶意刷分、恶意举报").t("-禁止涉及违规的言论、恶意言论、人身攻击").t("-禁止发布无意义、恶意高难的游戏，游戏内禁止出现违规内容").t("-禁止任何方式的爬取、篡改数据库、修改应用程序").t("注：违规内容包括但不限于涉及政治、广告、引战、谣言、色情、血腥暴力、猎奇的内容").b("同意并继续","取消").then(g=>{if(g.i)return;r[1].tx("注册中").aC("gray");let l=new DB.User;l.setUsername(t),l.setPassword(s),l.setEmail(o),l.signUp().then(t=>{A=t.get("username"),i("注册成功！验证邮件已发送到您的邮箱，请输入邮件中的验证码以完成账号验证："),r[1].tx("注册").rC("gray"),e[0].onclick(),a[0].value=A,a[1].value=s,n[0]._h(),DB.User.logOut()},A=>{let e;switch(A.code){case 119:e="注册暂未开放";break;case 202:e="该用户名已被注册";break;case 203:e="该邮箱地址已被注册";break;default:e="注册失败"}n[1].tx(e)._s(),r[1].tx("注册").rC("gray")})}):n[1].tx("请输入正确的邮箱地址")._s()},$("fp").onclick=()=>{UI.prompt("请输入注册邮箱：").then(A=>{if(!A.i)return A.v.trim().match(/[^@]+@.+\..+/)?void $U.resetPw(A.v.trim()):UI.alert("请输入正确的邮箱地址").then(()=>$("fp").click())})},s.for(A=>{A.onclick=()=>{let e=A.firstChild.firstChild.href,t=A.pS();"#-unsee"===e.baseVal?(e.baseVal="#-see",t.type=""):(e.baseVal="#-unsee",t.type="password")}});let g=$("am").getContext("2d"),l=[],c=[],h=0,C=0,m=100/6;l.i=0;for(let A=8;A--;){let e,t=new Image;switch(t.onload=()=>createImageBitmap(t,0,0,t.width,t.height).then(e=>{l[A]=e,l.i++}),A){case 0:e="CAAAAAgAQMAAABJtOi3AAAABlBMVEX///8AAABVwtN+AAAAAnRSTlN4eM+rx8gAAABhSURBVAjXHY67DYAwEENfIEihCxuETcJmB6KgZARGYTOwnOJddB/bfHq8kHhg5IaJC2ZOWDhgZYeNCNXoKRFtEGoWShFyFYYmpC6o+Oeep97zhW+tYj0r28Nu9nUCZ3G0H0DWHU3Glh8bAAAAAElFTkSuQmCC";break;case 1:e="CAAAAAgAgMAAAAOFJJnAAAADFBMVEUAAADd3d3z8/MHAACKo35GAAAAAXRSTlMAQObYZgAAAGBJREFUGNNdxsENgCAMQFGSnnEb3IRyYQiWMiaVAyN0CVxHbTCh5R9+nvsClmtsbcVeV9zXAkBiC4/ULAJStehIpwFEpIM1vKBoBEHW6IKkAFEQecIPlIkwkCf6QHLP3wsuT0yPH30M1wAAAABJRU5ErkJggg==";break;case 2:e="BUAAAAYBAMAAADnp6t7AAAAFVBMVEUAAADzAAAIAADzW1tkAAAjIyMTExM2FZfiAAAAAXRSTlMAQObYZgAAAH1JREFUGNNtz0EOgkAMBdDJJLr/jgfAygWGngCjezUcgAXc/wrMpwUCoauX9qdpw1JSrYwnFpGXM7ZIjdj4gaRNPZKXNqlKfjM0sC2KG9vmfK9CpPWpGcWgdWeYcTAWI2EzDrb9Vh+e5u6La498eejPTIZrR/oz/xIj/eGZE5JYFlJv/HWlAAAAAElFTkSuQmCC";break;case 3:e="CAAAAAQAgMAAAAKbpXKAAAADFBMVEVfUTdJOyUqIAcAAACFK7TvAAAARElEQVQI12P4DwUMr1aBwWoYYzGM0czwMhQMnJEYK7NWrVqZBWS0JggwMiYCGY0gRgKCgUXXCwYwYGZ4AGMcgDLgzgAAyK871Y+X3ZkAAAAASUVORK5CYII=";break;case 4:e="CAAAAAgAQMAAABJtOi3AAAAA1BMVEU/mf8FzEGpAAAAAXRSTlOgljB7jgAAAAtJREFUCNdjGOQAAACgAAH4BzM6AAAAAElFTkSuQmCC";break;case 5:e="CAAAAAdBAMAAAA5sHO0AAAAJFBMVEUAAAD/91VAQED///9VVVX/+YD06Qv/AACFUFAqKipQMDD/gIBlkX6EAAAAAXRSTlMAQObYZgAAAKlJREFUGNN90DEOwjAMBdBcoYzdoOICdRfm/IUDcAEGrtCICxTB2C4eO4HCARi4HPaCXEfq95DkyZashJ1LaGiRNjQAOiBCC1BgVpgiRrkqEHVRCwQ7oiCHABG64+Q6dAQCgAAzH0YpZpJrW+xRbhr8O+xPJhuFyuT8h5yXkB8pW6i/Q+pnCx8Hr5vkbuDdS8fVwNNBOVJrx7wGVR5SXlndRGF7MRHwH/QD1uBlmfIjLBAAAAAASUVORK5CYII=";break;case 6:e="CAAAAAgCAYAAABzenr0AAAAwklEQVR4nO2WSwrAIAxEe11v6Rm8ULsKSMg/kSo4kJXoPD+d5nmuGLXWXqjIeIkxLsv4MnNPLQXovZOVBokal0FYjMcYbHEgZQCS+TII6+4piDMBJAhsBNKuwGVOgWAATtIJhECiAGUQ1DvQtA1AOQSAHAMgxbMLACDgEWZPILV7z1cwQ6QSkQohLwBAhI5dimDJmLuG9O4tZr8DSI1KCICq2VjrnMpSkGu5pCam7JfsDZN0+GgQnvkhc7xQepGrnfUBCTrp+ep8x9gAAAAASUVORK5CYII=";break;case 7:e="GQAAAAVCAYAAACwnEswAAABWklEQVR4nO3ZUQqDMAwGYJ9krxvsZRfYMQZ79Qa7wW6yNw+yg+xYjoqVGJPaNqZUiPAzEcxnGuvLmibhODXNsJWUembsALzuFzZSxIwdASlkRiKCiw2/fhVpI2ZEAhjxRd11/JuDmJGIcBOnkGTADBlCbT+ImqFrzJDH4HaDkSJmJBxfVIyCpIgZGQCG8BacECpm7GFA4Hzrx1BbECYWcbV9jmyorxVs4ssA7txPm4NhzU/bjrW4+tjw57UZJdZqboQKB+BQ30z88JQTWqgajVJrxUL4xlAjxPcxaODva6iJmg2NtZohiFE3xoYEkCGpX5OhtVYLyMUj/sbHdO36fK+yWThgwBzZ0FirxRGaKgZyEdfMAwUbSW9UhMH1IukDD1yjj6g/WLKnLbQ16kqel3qxqOGLzK7rBi4lB0L5uXVL9xPqQdLHCtDcJTXsxNprz4fapAsbJazc2n8QN+yJaht7OwAAAABJRU5ErkJggg=="}t.src=PNG+e}const p=A=>{let e=A-C;if(Math.round(e)>=m<<0){if(8===l.i){if(g.clearRect(0,0,672,256),g.drawImage(l[7],25*(h<<0),0,25,21,320,203,25,21),h+=.2,h>=4){h-=4;let A=7*Math.random()<<0,e=(Math.random()-.5)/10;c.push({i:A,x:704,y:24+160*Math.random()<<0,a:6.2832*Math.random(),d:e<0?e-.02:e+.02,s:2+Math.random(),w:-l[A].width>>1,h:-l[A].height>>1})}for(let A=c.length;A--;){let e=c[A];if(e.x-=e.s,e.x<-24){c.splice(A,1);continue}e.a+=e.d;let t=Math.cos(e.a),r=Math.sin(e.a);g.setTransform(t,r,-r,t,e.x,e.y),g.drawImage(l[e.i],e.w,e.h)}g.setTransform(1,0,0,1,0,0);for(let A=8*-h<<0;A<672;A+=32)g.drawImage(l[0],A,224)}e-m<=1||e-m>=m?C=A:C+=m}requestAnimationFrame(p)};p()}