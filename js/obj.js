_C.O=class{constructor(s,t){this.x=s,this.y=t,this.scx=1,this.scy=1,this.ang=0,this.ind=0,this.h_=0,this.v_=0,this.spd=0,this.dir=0,this.V=[0,0,0,0,0,0,0,0],this.B=[0,0,0,0],this.BV=[0,1,6,7],this.calc=!1,this.moved=0,this.colS=[],this._des=!1}$d(){this.ly.upd=!0}calcBox(){this.calc||(this.calc=!0,_C.calcBox(this,this.w,this.h,this.boxL,this.boxT,this.V,this.B,this.BV))}moveB(s,t){this.x+=s,this.y+=t;let i=this.V;for(let h=0;h<8;h++)i[h]+=1&h?t:s;this.B[0]=Math.round(i[this.BV[0]]),this.B[1]=Math.round(i[this.BV[1]]),this.B[2]=Math.round(i[this.BV[2]]),this.B[3]=Math.round(i[this.BV[3]])}#s(s,t,i,h,e,r=0,o=0){let p=e.spr[0],d=e.ang*Math.DR,a=Math.cos(d),n=Math.sin(d),l=e.scx,c=e.scy,u=e.sprX,m=e.sprY,v=-e.x-r+.5,y=-e.y-o+.5,B=p.mask[e.ind<<0],x=e._w,f=e._h,M=p.bL,g=p.bT;for(let e=t;e<h;e++)for(let t=s;t<i;t++){let s=(a*(t+v)-n*(e+y))/l+u-M<<0;if(s<0||s>=x)continue;let i=(n*(t+v)+a*(e+y))/c+m-g<<0;if(!(i<0||i>=f)&&B[i*x+s])return!0}}_meet(s,t,i,h,e,r,o){if(this.px||o.px){let p=Math.max(i,o.B[0]),d=Math.max(h,o.B[1]),a=Math.min(e,o.B[2]),n=Math.min(r,o.B[3]);if(this.px||this.ang%90!=0){if(o.px||o.ang%90!=0){let i=this.spr[0],h=this.ang*Math.DR,e=Math.cos(h),r=Math.sin(h),l=this.scx,c=this.scy,u=this.sprX,m=this.sprY,v=-this.x-s+.5,y=-this.y-t+.5,B=i.mask[this.ind<<0],x=this._w,f=this._h,M=i.bL,g=i.bT,b=1-this.px,R=o.spr[0],k=o.ang*Math.DR,w=Math.cos(k),j=Math.sin(k),C=o.scx,V=o.scy,_=o.sprX,L=o.sprY,O=.5-o.x,S=.5-o.y,D=R.mask[o.ind<<0],T=o._w,X=o._h,P=R.bL,A=R.bT,Y=1-o.px;for(let s=d;s<n;s++)for(let t=p;t<a;t++){let i=(e*(t+v)-r*(s+y))/l+u-M<<0;if(i<0||i>=x)continue;let h=(r*(t+v)+e*(s+y))/c+m-g<<0;if(h<0||h>=f)continue;let o=(w*(t+O)-j*(s+S))/C+_-P<<0;if(o<0||o>=T)continue;let p=(j*(t+O)+w*(s+S))/V+L-A<<0;if(!(p<0||p>=X)&&(b|B[h*x+i])&(Y|D[p*T+o]))return!0}return!1}return this.#s(p,d,a,n,this,s,t)}return this.#s(p,d,a,n,o)}if(this.ang%90||o.ang%90){let i=[],h=o.V;for(let h=0;h<8;)i[h]=this.V[h]+s,i[++h]=this.V[h++]+t;for(let s=0;s<2;s++){for(let s=2;s<6;s+=2){let t=i[s]-i[0],e=i[s+1]-i[1],r=t*(h[0]-i[0])+e*(h[1]-i[1]),o=r;for(let s=2;s<8;s+=2){let p=t*(h[s]-i[0])+e*(h[s+1]-i[1]);p<r?r=p:p>o&&(o=p)}if(o<=0||r>=t*t+e*e)return!1}h=i,i=o.V}return!0}return!0}meet(s){return this.calcBox(),s<2?$R.Col.c[s].m(this,0,0,this.B[0],this.B[1],this.B[2],this.B[3]):this.col.p.mdu(this,s-2,0,0,this.B[0],this.B[1],this.B[2],this.B[3])}meetAll(s){this.calcBox();let t=[];return this.col.p.fdu(this,s-2,0,0,this.B[0],this.B[1],this.B[2],this.B[3],t),t}meetXY(s,t,i){return this.calcBox(),$R.Col._.md(this,i-2,s,t,Math.round(this.V[this.BV[0]]+s),Math.round(this.V[this.BV[1]]+t),Math.round(this.V[this.BV[2]]+s),Math.round(this.V[this.BV[3]]+t))}meetXYAll(s,t,i){this.calcBox();let h=[];return $R.Col._.fd(this,i-2,s,t,Math.round(this.V[this.BV[0]]+s),Math.round(this.V[this.BV[1]]+t),Math.round(this.V[this.BV[2]]+s),Math.round(this.V[this.BV[3]]+t),h),h}},_C.R=class extends _C.O{constructor(s,t,i,h,e){super(t,i),this.xp=t,this.yp=i,this.obj=s,this.dep=h,this.ly=$R.L[h],this.oid=this.ly.push(this),10===s?(this.calcBox=this.calcBoxG,this.activate=this.actvGrp,this.move=this.#t,this.draw=this.#i,this.$d=this.#i):(this.activate=this.actv,this.spr=e,this._w=e[0].boxW,this._h=e[0].boxH,this.move=this.#i,this.draw=this.dNormal,this.dSpr=_C.dSprN,this.sprX=e[0].x,this.sprY=e[0].y,this.boxL=this.sprX-e[0].bL,this.boxT=this.sprY-e[0].bT,this.cmo=this.obj+5,this.col={p:null,o:this.obj+3,io:-1,c:-1,ic:-1}),this.colMov=!1,this.al=1,this.hd=0,this.DEF=[],this.MOV=[],this.TML=[],this.tmlB=50,this.TRG=[[],[],[],[]],this.trgMap=[],this.VAR=[0,0,0,0],this.step0=this.timer=this.step1=this.step2=this.colli=this.#i,this.gscy=this.gscx=1,this.gag=0}set $x(s){s!==this.x&&(this.x=s,this.$d(),this.calc=!1,this.moved=2)}set $y(s){s!==this.y&&(this.y=s,this.$d(),this.calc=!1,this.moved=2)}set $scx(s){s!==this.scx&&(this.scx=s,this.w=s*this._w,this.$d(),this.calc=!1,this.moved=2)}set $scy(s){s!==this.scy&&(this.scy=s,this.h=s*this._h,this.$d(),this.calc=!1,this.moved=2)}set $ang(s){s!==this.ang&&(this.ang=s,this.$d(),this.calc=!1,this.moved=2)}set $h_(s){if(s!==this.h_)if(this.h_=s,this.v_){this.spd=(s*s+this.v_*this.v_)**.5;let t=-Math.atan(this.v_/s)/Math.DR;this.dir=(s<0?t+180:t+360)%360}else this.spd=s,s&&(this.dir=s<0?180:0)}set $v_(s){if(s!==this.v_)if(this.v_=s,this.h_){this.spd=(this.h_*this.h_+s*s)**.5;let t=-Math.atan(s/this.h_)/Math.DR;this.dir=(this.h_<0?t+180:t+360)%360}else this.spd=s,s&&(this.dir=s<0?90:270)}$hvspd(s,t){if((s!==this.h_||t!==this.v_)&&(this.h_=s,this.v_=t,this.spd=(s*s+t*t)**.5,this.spd)){let i=-Math.atan(t/s)/Math.DR;this.dir=(s<0?i+180:i+360)%360}}$dspd(s,t,i){if(s||t){let h=(s*s+t*t)**.5,e=-Math.atan(t/s)/Math.DR;this.dir=i<0?(s<0?e+360:e+180)%360:(s<0?e+180:e+360)%360,t=i*t/h,(s=i*s/h)===this.h_&&t===this.v_||(this.spd=Math.abs(i),this.h_=s,this.v_=t)}}set $spd(s){if(s!==this.spd){this.spd=s;let t=this.dir*Math.DR;this.h_=Math.cos(t)*s,this.v_=-Math.sin(t)*s}}set $dir(s){if(s!==this.dir&&(this.dir=s%360,this.spd)){let t=s*Math.DR;this.h_=Math.cos(t)*this.spd,this.v_=-Math.sin(t)*this.spd}}$spddir(s,t){if(s!==this.spd||t!==this.dir){this.spd=s,this.dir=t%360;let i=t*Math.DR;this.h_=Math.cos(i)*s,this.v_=-Math.sin(i)*s}}init(){let s=!1,t=!1,i=!1;if(this.mov&&this.mov.for(s=>{Lib.dmov[s[0]](this,s)&&(t=!0)}),this.tml&&(this.tml.for(i=>{const h=[];h.run=i[0],h.time=0,h.node=0,this.TML.push(h),i[1].for(i=>{const e={_:i};Lib.colAct.includes(i[0])?t=!0:1.05===i[0]?s=!0:.02===i[0]&&(0===i[2]&&(i[2]=Infinity),e.ct=0),i.f||(i.f=i[0]===i[0]<<0?Lib.dmov[i[0]]:Lib.act[i[0]<<0][Math.round(100*i[0]%100-1)]),h.push(e)})}),this.timer=this.#h),this.trg?.for(h=>{const e=[h[1]||Infinity,[1],h[2],h[3]];switch(this.TRG[h[0]].push(e),this.trgMap.push(e),e.ex=0,h[0]){case 0:this.step0=this.#e;break;case 1:this.step1=this.#r;break;case 2:this.step2=this.#o}let r=0;h[2].for(s=>{s[0]>2&&s[0]<2.05&&(i=!0,this.colS[s[2]]??={i:0,o:null,c:!1}),s.f||(s.f=Lib.trg[(s[0]<<0)-1][Math.round(100*s[0]%100-1)]),s[1]?e[1][++r]=1:++e[1][r]}),h[3].for(i=>{Lib.colAct.includes(i[0])?t=!0:1.05===i[0]&&(s=!0),i.f||(i.f=i[0]===i[0]<<0?Lib.dmov[i[0]]:Lib.act[i[0]<<0][Math.round(100*i[0]%100-1)])}),0==--e[1][e[1].length-1]&&e[1].splice(-1)}),this.def){let i=Lib.def[this.def];this.DEF.push(i[1].bind(this)),2===i[0]?t=!0:1===i[0]&&(s=!0)}if(t&&(this.colMov=t),10!==this.obj){if(this.tile)switch(this.spr[0].length){case 1:this.tile=!1;break;case 2:this.tile=[(this.tb>7)<<0],this.draw=this.dTile;break;case 4:this.tile=[this.tc?0:(3==(3&this.tb))+((12==(12&this.tb))<<1)],this.draw=this.dTile;break;case 20:this.tile=[this.tb];for(let s=0;s<4;s++)this.tc&1<<s&&this.tile.push(16+s);this.draw=this.dTile}switch(this.w=this.scx*this._w,this.obj){case 11:this.draw=this.dLaser,this._h=this.lso?this.len:0;break;case 22:this.draw=this.dRope,this._h=this.len}this.h=this.scy*this._h,this.initOxy(),this.calcBox(),this.moved=0,this.px=this.spr[0].px,this.spr[0].ims&&(this.DEF.push(Lib.def[0][1].bind(this)),s=!0),this.col.c=this.cm-2,0===this.cm&&(this.col.o=-1),$R.Col._.add(this),i&&(this.move=this.#p),(t||s)&&(this.move=this.#d)}else this.gpi||this.updGrp(1)}calcBoxG(){this.calc||(this.calc=!0,this.B[0]=Math.round(this.x),this.B[1]=Math.round(this.y),this.B[2]=this.B[0],this.B[3]=this.B[1])}actv(s,t,i,h){(this.B[0]<i&&this.B[1]<h&&this.B[2]>s&&this.B[3]>t||11===this.dep)&&this.ly.add(this)}actvGrp(s,t,i,h){(this.B[0]<i&&this.B[1]<h&&this.B[2]>s&&this.B[3]>t||this.grpO.some(e=>e.B[0]<i&&e.B[1]<h&&e.B[2]>s&&e.B[3]>t||11===e.dep))&&(this.ly.add(this),this.grpO.for(e=>{e.B[0]<i&&e.B[1]<h&&e.B[2]>s&&e.B[3]>t||11===e.dep||e.ly.add(e)}))}get hsp(){return this.x-this.xp}get vsp(){return this.y-this.yp}destroy(){this._des=!0,this.$d(),10===this.obj?this.grpO.for(s=>s.gpi=""):this.col.p&&this.col.p.rm(this),this.moved=2}outRoom(){this.gpi||this.destroy()}updColO(s){if(s.colS[this.cm]&&this.col.c>=0){let t=s.colS[this.cm];t.c||(0!==t.i&&3!==t.i||(t.i=1),t.o=this,t.c=!0)}if(s.colS[this.cmo]&&this.col.o>=0){let t=s.colS[this.cmo];t.c||(0!==t.i&&3!==t.i||(t.i=1),t.o=this,t.c=!0)}}updCol(s){let t=this.colS[s];if(t.c)return t.i;if(0===t.i){let i=this.meet(s);i&&(t.i=1,t.o=i,this.updColO(i))}else if(2===t.i&&(this.moved||t.o.moved)){let i=this.meet(s);i?this.updColO(i):t.i=3,t.o=i}return t.c=!0,t.i}initOxy(){if(this.a){let s=this.a-1,t=this.spr[0];this.sprX=1&s?t.w>>1:2&s?t.w:0,this.sprY=4&s?t.h>>1:8&s?t.h:0,this.boxL=this.sprX-t.bL,this.boxT=this.sprY-t.bT}}moveOxy(s){let t,i;s?(t=1&--s?this.spr[0].w>>1:2&s?this.spr[0].w:0,i=4&s?this.spr[0].h>>1:8&s?this.spr[0].h:0):(t=this.spr[0].x,i=this.spr[0].y),_C.moveOxy(this,t,i),this.boxL=this.sprX-this.spr[0].bL,this.boxT=this.sprY-this.spr[0].bT}out(){this.gpi}bounce(){this.gpi}updGrp(s=0){for(let t=this.grpO.length;t--;){let i=this.grpO[t];if(i._des){this.grpO.splice(t,1);continue}s&&this.colMov&&!i.colMov&&(i.colMov=!0,i.move=i.#d);let h=this._gp[i._gn];this.csc&&(i.scx/=i.gscx,i.gscx=this.scx,i.$scx=i.scx*i.gscx,i.scy/=i.gscy,i.gscy=this.scy,i.$scy=i.scy*i.gscy),this.cag&&(i.ang-=i.gag,i.gag=this.ang,i.$ang=i.ang+i.gag);let e=(h.x+i.grpX)*this.scx,r=(h.y+i.grpY)*this.scy;if(this.ang){let s=this.ang*Math.DR,t=Math.cos(s),i=Math.sin(s),h=-e*i+r*t;e=e*t+r*i,r=h}i.$x=this.x+e,i.$y=this.y+r,10===i.obj?i.updGrp(s):i.col.p&&i.moved>1&&i.col.p.upd(i)}}#i(){}trigger(s){if(s[0]&&0===s.ex){s.ex=1;let t=0;for(let i=0;i<s[1].length;i++){let h=s[1][i],e=1;for(let i=0;i<h;i++){const h=s[2][t+i];if(!h.f(this,h)){e=0;break}}if(e){--s[0],s[3].for(s=>s.f(this,s));break}t+=h}s.ex=0}}#h(){for(let s=0;s<this.TML.length;s++){const t=this.TML[s];if(t.run){for(;t.run&&0===t.time;){const s=t[t.node++];if(!s){t.run=0,t.time=0,t.node=0;break}s._.f(this,s._,t,s)}t.run&&t.time>0&&--t.time}}}#t(){this.moved=0;for(let s=this.MOV.length;s--;)this.MOV[s]&&this.MOV[s](this)&&(this.MOV[s]=null)}#d(){this.xp=this.x,this.yp=this.y,this.moved=0,this.#p();for(let s=this.MOV.length;s--;)this.MOV[s]&&this.MOV[s](this)&&(this.MOV[s]=null);this.DEF.for(s=>s()),this.moved>1&&this.cm&&this.col.p.upd(this)}#p(){for(let s=this.colS.length;s--;){const t=this.colS[s];t&&(1===t.i?t.i=2:3===t.i&&(t.i=0),t.c=!1)}}#e(){for(let s=0;s<this.TRG[0].length;s++)this.trigger(this.TRG[0][s])}#r(){for(let s=0;s<this.TRG[1].length;s++)this.trigger(this.TRG[1][s])}#o(){for(let s=0;s<this.TRG[2].length;s++)this.trigger(this.TRG[2][s])}dNormal(){this.hd||0===this.al||0===this.scx||0===this.scy||this.dSpr(this.spr[0],this.ind<<0)}dTile(){this.hd||0===this.al||this.tile.for(s=>this.dSpr(this.spr[0],s))}dRope(){if(this.hd||0===this.al)return;let s=this.spr[0],t=Math.round(this.len)-32;for($R.rr.draw(s[1],this.x,this.y,-this.sprX,t,this.scx,this.scy,this.ang,this.al);t>0;t-=32)t>=32?$R.rr.draw(s[0],this.x,this.y,-this.sprX,t-32,this.scx,this.scy,this.ang,this.al):$R.rr.draw(s[1+t],this.x,this.y,-this.sprX,0,this.scx,this.scy,this.ang,this.al)}dLaser(){if(this.hd&&!this.lso||0===this.al)return;let s=this.spr[0];this.lso&&$R.rr.draw(s[1],this.x,this.y,-this.sprX,0,this.scx,this.h/s.h,this.ang,this.al),this.hd||$R.rr.draw(s[0],this.x,this.y,-this.sprX,0,this.scx,this.scy,this.ang,this.al)}},_C.Y=class extends _C.O{#a;constructor(s,t){super(s,t),$R.plyX=s,$R.plyY=t,this.#a=1,this.spr=$R._r.Spr.pli,this.ims=.2,this.px=0,this.ly=$R.L[7],this.ox=17,this.oy=23,this.moveSpd=3,this.maxVspd=9,this.jump1=-8.5,this.jump2=-7,this.grav=.4,this.fric=.5,this.ahspd=0,this.phspd=0,this.pvspd=0,this.onPlat=!1,this.onLadder=!1,this.onRope=null,this.meetRope=null,this.meetMov=null,this.shoot=0,this.frozen=!1,$R.initPly(this),this.djump=this.jump,this.state=new _C.State({ind:0,spr:this.spr,x:this.x,y:this.y,scx:this.scx,scy:this.scy,g:this.g_}),this.$d(),this.clacLTRB(),this.calcBox()}calcBox(){this.V[0]=this.V[4]=this.B[0]=this.x+this._L,this.V[1]=this.V[3]=this.B[1]=this.y+this._T,this.V[2]=this.V[6]=this.B[2]=this.x+this._R,this.V[5]=this.V[7]=this.B[3]=this.y+this._B}clacLTRB(){switch(this.g_){case 270:this._T=-12*this.scy,this._B=9*this.scy,this._L=-5*this.#a,this._R=6*this.#a;break;case 90:this._T=-9*this.scy,this._B=12*this.scy,this._L=-5*this.#a,this._R=6*this.#a;break;case 0:this._T=-6*this.#a,this._B=5*this.#a,this._L=-12*this.scy,this._R=9*this.scy;break;case 180:this._T=-5*this.#a,this._B=6*this.#a,this._L=-9*this.scy,this._R=12*this.scy}}setGrav(s){if(s!==this.g_){if(this.v_=0,this.ahspd=0,s%180==this.g_%180)switch(s){case 270:this.y+=4;break;case 90:this.y-=4;break;case 0:this.x+=4;break;case 180:this.x-=4}this.g_=s,this.ang=(s+90)%360,this.clacLTRB(),this.calcBox(),this.moved=2}}meet(s,t,i){let h,e;switch(this.g_){case 270:h=s,e=t;break;case 90:h=s,e=-t;break;case 0:h=t,e=-s;break;case 180:h=-t,e=s}return $R.Col._.md(this,i-2,h,e,Math.round(this.B[0]+h),Math.round(this.B[1]+e),Math.round(this.B[2]+h),Math.round(this.B[3]+e))}meetAll(s,t,i){let h,e,r=[];switch(this.g_){case 270:h=s,e=t;break;case 90:h=s,e=-t;break;case 0:h=t,e=-s;break;case 180:h=-t,e=s}return $R.Col._.fd(this,i-2,h,e,Math.round(this.B[0]+h),Math.round(this.B[1]+e),Math.round(this.B[2]+h),Math.round(this.B[3]+e),r),r}meetO(s,t,i,h,e,r,o){return!!(e>o.B[0]&&r>o.B[1]&&i<o.B[2]&&h<o.B[3]&&this._meet(s,t,i,h,e,r,o))}meetObj(s,t,i){let h,e;switch(this.g_){case 270:h=s,e=t;break;case 90:h=s,e=-t;break;case 0:h=t,e=-s;break;case 180:h=-t,e=s}let r=Math.round(this.B[0]+h),o=Math.round(this.B[1]+e),p=Math.round(this.B[2]+h),d=Math.round(this.B[3]+e);for(let s=i.length;s--;)if(this.meetO(h,e,r,o,p,d,i[s]))return!0;return!1}meet0(s){return $R.Col._.md(this,s-2,0,0,Math.round(this.B[0]),Math.round(this.B[1]),Math.round(this.B[2]),Math.round(this.B[3]))}meet0All(s){let t=[];return $R.Col._.fd(this,s-2,0,0,Math.round(this.B[0]),Math.round(this.B[1]),Math.round(this.B[2]),Math.round(this.B[3]),t),t}com(){if(0===this.shoot&&($C.P("z")||this.conShoot&&$C.C("z"))&&(Au.play("st"),this.shoot=5,new _C.B(this.x,this.y,this.scx,this.g_)),this.shoot&&this.shoot--,this.h_&&this.g_%180){let s=this.meet(this.h_,0,24);if(s&&0===s.v_){let t=Math.sign(this.h_);s.meetXY(t,0,2)||(s.$h_=s.meetXY(2*t,0,2)?t:2*t,s.MOV[0]=Lib.mov[0],s.MOV[5]=null)}}}step(){if(this.frozen)return;this.calcBox(),this.grav=this.meet0(36)?.7:this.meet0(35)?.2:this._grav,this.moveSpd=this.meet0(38)?1:this.meet0(37)?6:this._moveSpd;let s=$C.C("R")||-$C.C("L");if(this.meet0(26)){let t=$C.C("D")||-$C.C("U");if(t&&(this.onLadder=!0),this.onLadder){if(this.spr=$R._r.Spr.plb,this.ims=.2,this.djump=this.jump,s&&(this.scx=this.#a*s),this.h_=this.moveSpd*s,this.v_=this.moveSpd*t,this.grav=0,!$C.P("J"))return this.com();this.onLadder=!1,this.grav=.4,this.v_=0}}else this.onLadder&&(this.onLadder=!1,this.grav=.4,this.v_=0);let t=this.meet0(27);if(t){if(!this.onRope&&this.meetRope!==t){let s=((this.x-t.x)**2+(this.y-t.y)**2)**.5<<0;s>=0&&s<=t.h&&(this.onRope=t,this.meetRope=t,this.onRopeLen=s)}if(this.onRope){this.spr=$R._r.Spr.plb,this.ims=.2,this.djump=this.jump,s&&(this.scx=this.#a*s),this.grav=0,this.h_=0,this.v_=0;let t=$C.C("D")||-$C.C("U"),i=this.onRope.ang*Math.DR,h=Math.sin(i),e=Math.cos(i);if(this.onRopeLen+=this.moveSpd*t,this.platMove(this.onRope.x+this.onRopeLen*h-this.x,this.onRope.y+this.onRopeLen*e-this.y),!($C.P("J")||this.onRopeLen<0||this.onRopeLen>this.onRope.h))return this.com();this.onRope=null,this.grav=.4,this.phspd=0,this.pvspd=0}}else this.meetRope=null,this.onRope&&(this.onRope=null,this.grav=.4,this.phspd=0,this.pvspd=0);let i=this.meet(0,1,2),h=0;if(!i){let s=this.meet(-1,0,19)||this.meet(1,0,19);if(s){let t=(s.ang-this.g_+270)%360;h=0===t?-1:180===t?1:0,h&&90===this.g_&&(h=-h)}}let e=this.meet(0,1,10);if(s){if(!h||s===h){if(this.scx=this.#a*s,e){let t=this.moveSpd*s,i=e.fra*this.moveSpd;Math.abs(this.h_-t)<i&&(this.h_=t),this.h_<t?this.h_+=i:this.h_>t&&(this.h_-=i)}else this.h_=this.moveSpd*s;this.spr=$R._r.Spr.plr,this.ims=.5}}else{if(e){let s=e.frd*this.moveSpd;Math.abs(this.h_-0)<s&&(this.h_=0),this.h_<0?this.h_+=s:this.h_>0&&(this.h_-=s)}else this.h_=0;this.spr=$R._r.Spr.pli,this.ims=.2}this.adMove&&i&&($C.P("a")&&(this.h_-=1),$C.P("d")&&(this.h_+=1));let r=this.meet(0,1,56);r?this.h_+=r.csp:(r=this.meet(0,1,25),r&&(this.h_-=r.csp)),this.onPlat?this.meet(0,4,3)||(this.onPlat=!1):i||(this.spr=this.v_<0?$R._r.Spr.plj:$R._r.Spr.plf,this.ims=.2);let o=this.meet0(5);if(o&&(this.v_>2&&(this.v_=2),49===o.obj&&(this.djump=this.jump)),this.v_>this.maxVspd&&(this.v_=this.maxVspd),this.com(),this.jump&&$C.P("J")&&(i||this.onPlat||this.meet(0,1,3)||o&&16===o.obj?(this.v_=this.jump1,this.djump=this.jump,this.spr=$R._r.Spr.plj,this.ims=.2,Au.play("jp")):(this.djump>1||o&&17!==o.obj||-1===this.djump)&&(this.v_=this.jump2,this.djump>1&&this.djump--,this.spr=$R._r.Spr.plj,this.ims=.2,Au.play("jp",2))),this.v_<0&&$C.R("J")&&(this.v_*=.45),h){if(this.v_=2,this.spr=$R._r.Spr.plt,this.ims=.5,this.scx=this.#a*h,!($C.P("R")&&1===h||$C.P("L")&&-1===h))return this.meetMov=null;this.ims=.2,$C.C("J")?(this.spr=$R._r.Spr.plj,this.v_=-9,this.h_=15*h,Au.play("wj")):(this.spr=$R._r.Spr.plf,this.h_=3*h)}this.meetMov=this.meetAll(0,2,2),this.meetAll(0,2,3).for(s=>this.meetMov.push(s))}p2o(s,t){switch(this.g_){case 270:return[s,t];case 90:return[s,-t];case 0:return[t,-s];case 180:return[-t,s]}}platMove(s,t){switch(this.g_){case 270:this.phspd=s,this.pvspd=t;break;case 90:this.phspd=s,this.pvspd=-t;break;case 0:this.phspd=-t,this.pvspd=s;break;case 180:this.phspd=t,this.pvspd=-s}}applyMove(s,t){switch(this.g_){case 270:this.ahspd=s,this.v_=t;break;case 90:this.ahspd=s,this.v_=-t;break;case 0:this.ahspd=-t,this.v_=s;break;case 180:this.ahspd=t,this.v_=-s}}moveBy(s,t){switch(this.g_){case 270:this.x+=s,this.y+=t;break;case 90:this.x+=s,this.y-=t;break;case 0:this.y-=s,this.x+=t;break;case 180:this.y+=s,this.x-=t}}moveByB(s,t){this.moveBy(s,t),this.calcBox()}move(){if(this.moved=0,this.frozen)return;if(this.ind+=this.ims,this.ind>=this.spr.length&&(this.ind=0),this.meetMov){let s=0,t=Infinity;this.meetMov.for(i=>{if(!i._des){let h=i.vsp;h<t&&(t=h,s=i.hsp)}}),Number.isFinite(t)||(t=0),(s||t)&&this.platMove(s,t)}this.ahspd>0?(this.ahspd-=this.fric,this.ahspd<0&&(this.ahspd=0)):this.ahspd<0&&(this.ahspd+=this.fric,this.ahspd>0&&(this.ahspd=0)),this.h_+=this.ahspd,this.v_+=this.grav;let s=this.h_+this.phspd,t=this.v_+this.pvspd;if(s||t){let i=Math.round(this.B[0]),h=Math.round(this.B[1]),e=Math.round(this.B[2]),r=Math.round(this.B[3]);this.moveBy(s,t),this.calcBox(),i===Math.round(this.B[0])&&h===Math.round(this.B[1])&&e===Math.round(this.B[2])&&r===Math.round(this.B[3])||(this.moved=2)}}colli(){if(this.frozen)return;let s=Math.round(this.B[0]),t=Math.round(this.B[1]),i=Math.round(this.B[2]),h=Math.round(this.B[3]),e=this.meet0All(2);if(e.length){let s=0,t=0,i=0,h=0,r=0,o=0,[p,d]=this.p2o(this.h_+this.phspd,this.v_+this.pvspd);switch(e.for(e=>{let r=p-e.hsp,o=d-e.vsp;r<0?i=Math.min(i,r):r>0&&(s=Math.max(s,r)),o<0?h=Math.min(h,o):o>0&&(t=Math.max(t,o))}),this.g_){case 270:break;case 90:d=-d,[t,h]=[-h,-t];break;case 0:[p,d,s,t,i,h]=[-d,p,-h,s,-t,i];break;case 180:[p,d,s,t,i,h]=[d,-p,t,-i,h,-s]}if(s&&s!==p&&(s+=1,r=1),t&&t!==d&&(t+=1),i&&(i!==p&&(i-=1,o=-1),s||(s=i,i=0,r=o,o=0)),h&&(h!==d&&(h-=1),t||(t=h,h=0)),!s&&!t||this.meetObj(-s,-t,e)?!s&&!h||this.meetObj(-s,-h,e)?!i&&!t||this.meetObj(-i,-t,e)?!i&&!h||this.meetObj(-i,-h,e)?!p&&!d||this.meetObj(-p,-d,e)?(s=0,t=0):(s=p,t=d,r=0,this.moveByB(-p,-d)):(s=i,r=o,t=h,this.moveByB(-s,-t)):(s=i,r=o,this.moveByB(-s,-t)):(t=h,this.moveByB(-s,-t)):this.moveByB(-s,-t),s&&this.meet(s,0,2)){for(let t=Math.sign(s),i=Math.abs(s),h=0;h<i&&!this.meet(t,0,2);h++)this.moveByB(t,0);this.ahspd=this.h_=s=0}if(t&&this.meet(0,t,2)){for(let s=Math.sign(t),i=Math.abs(t),h=0;h<i&&!this.meet(0,s,2);h++)this.moveByB(0,s);t>0?(this.djump=this.jump,this.v_=0):this.v_=d-t>0?d-t:0,t=0}(s||t)&&this.meet(s,t,2)&&(this.ahspd=this.h_=0,s=r),(s||t)&&this.moveByB(s,t)}this.phspd=0,this.pvspd=0;let r=this.meet0All(3);for(let s=r.length;s--;){let t=r[s];if(t.ang%180==(this.g_+90)%180)switch(this.g_){case 270:{let s=t.B[1];if(this.y-this.v_/2<=s&&!this.meet(0,s-9-this.y,2)){let i=t.v_>0?t.v_:0;this.moveByB(0,s-9-this.y),this.v_=i,this.onPlat=!0,this.djump=this.jump}break}case 90:{let s=t.B[3];if(this.y+this.v_/2>=s&&!this.meet(0,this.y-s-9,2)){let i=t.v_<0?-t.v_:0;this.moveByB(0,this.y-s-9),this.v_=i,this.onPlat=!0,this.djump=this.jump}break}case 0:{let s=t.B[0];if(this.x-this.v_/2<=s&&!this.meet(0,s-9-this.x,2)){let i=t.h_>0?t.h_:0;this.moveByB(0,s-9-this.x),this.v_=i,this.onPlat=!0,this.djump=this.jump}break}case 180:{let s=t.B[2];if(this.x+this.v_/2>=s&&!this.meet(0,this.x-s-9,2)){let i=t.h_<0?-t.h_:0;this.moveByB(0,this.x-s-9),this.v_=i,this.onPlat=!0,this.djump=this.jump}break}}}let o=$R._r;switch(o.out){case 4:case 8:if(this.x<0?this.x+=o.w:this.x>=o.w&&(this.x-=o.w),8===o.out){if(this.y<0||this.y>=o.h)return this.kill(!0);break}case 16:if(this.y<0?this.y+=o.h:this.y>=o.h&&(this.y-=o.h),4===o.out)break;if(this.x<0||this.x>=o.w)return this.kill(!0);break;default:if(this.x<0||this.y<0||this.x>=o.w||this.y>=o.h)return this.kill(!0)}if(this.meet0(2))return this.kill(!0);if(this.meet0(4)&&this.kill())return;switch($R.plyX=this.x,$R.plyY=this.y,s===Math.round(this.B[0])&&t===Math.round(this.B[1])&&i===Math.round(this.B[2])&&h===Math.round(this.B[3])||(this.moved=2),$R.saveMode){case 0:if(!$C.P("s"))break;case 2:let s=this.meet0(7);!s||0!==s.ind||0!==$R.saveMode&&$R.saveX===this.x&&$R.saveY===this.y||(s.ind=1.78125,s.$d(),$R.save())}let p=this.meet0(6);p&&$R.warp(p.wr,p.ws,p.wx,p.wy);const d=this.state;d.ind=this.ind<<0,d.spr=this.spr,d.x=this.x,d.y=this.y,d.scx=this.scx,d.scy=this.scy,d.g=this.g_,d.$d()&&this.$d()}destroy(){this.$d(),this.moved=2,$R.$=null}kill(s=!1){if(!s&&$R.god)return;Au.play("dth");let t=new _C.R(0,400,304,11,[$R._r.sprGO]);return Object.assign(t,$R._r.bobj.gov),t.cm=0,t.init(!0),t.ly.add(t),$R.addDth(),this.destroy(),!0}draw(){$R.rr.draw(this.spr[this.ind<<0],this.x,this.y,-this.ox,-this.oy,90===this.g_?-this.scx:this.scx,this.scy,this.g_-270)}},_C.B=class extends _C.O{constructor(s,t,i,h){super(Math.round(s),Math.round(t)),this.des=40,this.spr=$R._r.Spr.blt,this.ly=$R.L[7],this.scx=i<0?-i:i,this.scy=this.scx,this.w=Math.round(this.scx*this.spr.w),this.h=Math.round(this.scy*this.spr.h);let e=this.w>>1,r=this.h>>1;switch(this.B=[s-e,t-r,s-e+this.w,t-r+this.h],$R.Col.c[1].o.push(this),h){case 270:case 90:this.h_=16*i<<0;break;case 0:this.v_=16*-i<<0;break;case 180:this.v_=16*i<<0}this.moved=2}destroy(){this.des=0}meet(s){return $R.Col._.md(this,s-2,0,0,this.B[0],this.B[1],this.B[2],this.B[3])}meetDes(s){let t=this.meet(s);return t&&(this.updColO(t),this.destroy()),t}updColO(s){let t=s.colS[1];t&&!t.c&&(0!==t.i&&3!==t.i||(t.i=1),t.o=this,t.c=!0)}move(){this.B[0]+=this.h_,this.B[1]+=this.v_,this.B[2]+=this.h_,this.B[3]+=this.v_,this.V[0]=this.V[4]=this.B[0],this.V[1]=this.V[3]=this.B[1],this.V[2]=this.V[6]=this.B[2],this.V[5]=this.V[7]=this.B[3],this.ind=1-this.ind,this.$d(),this.meetDes(2),this.meetDes(55),this.meetDes(42)}colli(){if(--this.des>0&&this.des&&$R.$&&1===$R.saveMode){let s=this.meet(7);s&&0===s.ind&&(s.ind=1.78125,s.$d(),$R.save(),this.updColO(s),this.destroy())}}draw(){$R.rr.draw(this.spr[this.ind],this.B[0],this.B[1],0,0,this.scx,this.scy)}},_C.P=class{constructor(s,t,i,h=7){this.x=s,this.y=t,this.spr=i,this.ind=0,this.sprX=i.w>>1,this.sprY=i.h>>1,this._des=!1,$R.L[h].eff(this),this.al=1,this.scx=1,this.scxA=1,this.scy=1,this.scyA=1,this.ang=0,this.aspd=.1,this.xspd=0,this.yspd=0,this.h_=0,this.v_=0,this.grav=0,this.acc=0,this.rot=0,this.dSpr=_C.dSprN}move(){if(this.v_+=this.grav,this.acc&&(this.h_||this.v_)){let s=(this.h_*this.h_+this.v_*this.v_)**.5,t=(s+this.acc*Math.sign(s))/s;t<=0?(this.h_=0,this.v_=0):(this.h_*=t,this.v_*=t)}this.x+=this.h_,this.y+=this.v_,this.al-=this.aspd,this.scx+=this.xspd,this.scy+=this.yspd,this.ang+=this.rot,(this.al<=0||this.scx*this.scxA<=0||this.scy*this.scyA<=0)&&(this._des=!0)}draw(){this.dSpr(this.spr,this.ind)}},_C.S=class extends _C.P{constructor(s,t,i,h=7){super(s,t,i[0],h),this.spr=i,this.draw=_C.O.prototype.dNormal}static from(s){if(0===s.al||11!==s.obj&&s.hd||11===s.obj&&s.hd&&!s.lso)return;let t=new _C.S(s.x,s.y,s.spr,s.dep),i=t.sprX,h=t.sprY;return t.ind=s.ind<<0,t.scx=s.scx,t.scx<0&&(t.scxA=-1),t.scy=s.scy,t.scy<0&&(t.scyA=-1),t.ang=s.ang,t.draw=s.draw,t.sprX=s.sprX,t.sprY=s.sprY,_C.moveOxy(t,i,h),s.tile?t.tile=s.tile:11===s.obj?(t.lso=s.lso,t.h=s.h):22===s.obj&&(t.len=s.len),t}},_C.D=class{static circle(s,t,i,h=0){let e=Math.PI2/t;for(let r=0;r<t;r++){let t=h+r*e;s(Math.cos(t)*i,-Math.sin(t)*i)}}static polygon(s,t,i,h,e=0){let r=Math.PI2/t,o=Math.cos(e)*h,p=-Math.sin(e)*h,d=Math.sin(r/2)*h*2/i;for(let h=0;h<t;h++){let t=Math.PI/2+e+(h+.5)*r,a=Math.cos(t)*d,n=Math.sin(t)*d;for(let t=0;t<i;t++)s(o,p),o+=a,p-=n}}};